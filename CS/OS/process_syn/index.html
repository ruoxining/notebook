
<!doctype html>
<html lang="zh" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://ruoxining.github.io/OBvault/CS/OS/process_syn/">
      
      
        <link rel="prev" href="../overview/">
      
      
        <link rel="next" href="../mem_file/">
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.18">
    
    
      
        <title>è¿›ç¨‹ä¸åŒæ­¥ - MiniBabelLibrary</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.26e3688c.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.ecc896b0.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../_css/style.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="black" data-md-color-accent="indigo">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#os-lecture" class="md-skip">
          è·³è½¬è‡³
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="é¡µçœ‰">
    <a href="../../.." title="MiniBabelLibrary" class="md-header__button md-logo" aria-label="MiniBabelLibrary" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MiniBabelLibrary
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              è¿›ç¨‹ä¸åŒæ­¥
            
          </span>
        </div>
      </div>
    </div>
    
      
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="æœç´¢" placeholder="æœç´¢" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="æŸ¥æ‰¾">
        
        <button type="reset" class="md-search__icon md-icon" title="æ¸…ç©ºå½“å‰å†…å®¹" aria-label="æ¸…ç©ºå½“å‰å†…å®¹" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            æ­£åœ¨åˆå§‹åŒ–æœç´¢å¼•æ“
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/ruoxining/OBvault" title="å‰å¾€ä»“åº“" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    OBvault
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="å¯¼èˆªæ " data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="MiniBabelLibrary" class="md-nav__button md-logo" aria-label="MiniBabelLibrary" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    MiniBabelLibrary
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/ruoxining/OBvault" title="å‰å¾€ä»“åº“" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    OBvault
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          ç”³è¯·å¿ƒå¾—
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          ç”³è¯·å¿ƒå¾—
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../App/" class="md-nav__link">
        ç´¢å¼•
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../App/24fall/" class="md-nav__link">
        24fallç”³è¯·è®°å½•
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../App/zju_ling_cs/" class="md-nav__link">
        è‹±ä¸“è½¬CS&NLPæŒ‡åŒ—
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../App/nlp_phd/" class="md-nav__link">
        NLPç”³è¯·PhDç»éªŒ(æ¬è¿)
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          CSä¸“æ 
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          CSä¸“æ 
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../" class="md-nav__link">
        ç´¢å¼•
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../c_lang/" class="md-nav__link">
        Cè¯­æ³•
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../libgraphics/" class="md-nav__link">
        Cå¤§ç¨‹libgraphicsä½¿ç”¨è®°å½•
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../coding_code/" class="md-nav__link">
        ç¼–ç¨‹è§„èŒƒæ–‡æ¡£æ¨¡æ¿
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_5" >
      
      
      
        <label class="md-nav__link" for="__nav_3_5" id="__nav_3_5_label" tabindex="0">
          C++æŒç»­è¿›æ­¥
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_5">
          <span class="md-nav__icon md-icon"></span>
          C++æŒç»­è¿›æ­¥
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CPP/course/" class="md-nav__link">
        ZJUå¬è¯¾
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CPP/final_review/" class="md-nav__link">
        ZJUæœŸæœ«å¤ä¹ 
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CPP/inheritance/" class="md-nav__link">
        ç»§æ‰¿
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CPP/templates/" class="md-nav__link">
        æ¨¡æ¿å’Œæ ‡å‡†æ¨¡æ¿åº“
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CPP/type/" class="md-nav__link">
        ç±»å‹å’Œç±»å‹è½¬æ¢
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CPP/file_io/" class="md-nav__link">
        æ–‡ä»¶è¯»å†™
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CPP/copy/" class="md-nav__link">
        æµ…æ‹·è´å’Œæ·±æ‹·è´
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CPP/namespace/" class="md-nav__link">
        å‘½åç©ºé—´
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../x86assm/" class="md-nav__link">
        x86æ±‡ç¼–
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_7" checked>
      
      
      
        <label class="md-nav__link" for="__nav_3_7" id="__nav_3_7_label" tabindex="0">
          OSæ“ä½œç³»ç»Ÿ
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_7_label" aria-expanded="true">
        <label class="md-nav__title" for="__nav_3_7">
          <span class="md-nav__icon md-icon"></span>
          OSæ“ä½œç³»ç»Ÿ
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../" class="md-nav__link">
        ç´¢å¼•
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../overview/" class="md-nav__link">
        è¯¾ç¨‹å¼•å…¥
      </a>
    </li>
  

            
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          è¿›ç¨‹ä¸åŒæ­¥
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        è¿›ç¨‹ä¸åŒæ­¥
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="ç›®å½•">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      ç›®å½•
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#2-process" class="md-nav__link">
    2. è¿›ç¨‹ Process
  </a>
  
    <nav class="md-nav" aria-label="2. è¿›ç¨‹ Process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    2.1 ç»„æˆ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    2.2 è¿›ç¨‹çš„çŠ¶æ€
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-process-control-block-pcb-aka-task-control-block" class="md-nav__link">
    2.3 è¿›ç¨‹æ§åˆ¶å—Process Control Block (PCB, aka. task control block)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-pid" class="md-nav__link">
    2.4 è¿›ç¨‹çš„åˆ›å»ºï¼Œpid
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25" class="md-nav__link">
    2.5 è¿›ç¨‹çš„ç»ˆæ­¢
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#26-ipcinterprocess-communication" class="md-nav__link">
    2.6 è¿›ç¨‹é—´é€šä¿¡IPCï¼ŒInterProcess Communication
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-scheduling" class="md-nav__link">
    3. è°ƒåº¦Scheduling
  </a>
  
    <nav class="md-nav" aria-label="3. è°ƒåº¦Scheduling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    3.1 è°ƒåº¦çš„æ—¶æœº
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-context-switchin" class="md-nav__link">
    3.2 è¿‡ç¨‹ï¼ˆä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œcontext switchinï¼‰
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    3.3 è°ƒåº¦ç®—æ³•è¯„ä»·
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    3.4 è°ƒåº¦ç®—æ³•
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-threads" class="md-nav__link">
    4. çº¿ç¨‹ threads
  </a>
  
    <nav class="md-nav" aria-label="4. çº¿ç¨‹ threads">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    4.1 åŠ¨æœºå’Œæ¦‚å¿µ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42" class="md-nav__link">
    4.2 ä¼˜ç¼ºç‚¹
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43" class="md-nav__link">
    4.3 å®ç°æ–¹å¼ï¼šç”¨æˆ·çº§/å†…æ ¸æ€ï¼Œå¤šçº¿ç¨‹æ¨¡å‹
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-synchronization" class="md-nav__link">
    5. åŒæ­¥å’ŒåŒæ­¥å·¥å…· Synchronization
  </a>
  
    <nav class="md-nav" aria-label="5. åŒæ­¥å’ŒåŒæ­¥å·¥å…· Synchronization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-cs-problem" class="md-nav__link">
    5.1 å¼•å…¥å’ŒCS Problem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-petersons-solution" class="md-nav__link">
    5.2 Petersonâ€™s Solution
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53" class="md-nav__link">
    5.3 ç¡¬ä»¶æŒ‡ä»¤
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54-semaphores" class="md-nav__link">
    5.4 ä¿¡å·é‡ Semaphores
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55-atomic-variable" class="md-nav__link">
    5.5 Atomic Variable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#56-mutex-mutual-exclusion-lock" class="md-nav__link">
    5.6 Mutex (Mutual Exclusion Lock)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#57-priority-inversion" class="md-nav__link">
    5.7 Priority Inversion
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    6. ç»å…¸åŒæ­¥é—®é¢˜
  </a>
  
    <nav class="md-nav" aria-label="6. ç»å…¸åŒæ­¥é—®é¢˜">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-bounded-buffer-problem" class="md-nav__link">
    6.1 Bounded-buffer Problem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-reader-writer-problem" class="md-nav__link">
    6.2 Reader-Writer Problem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-dining-philosophers-problem" class="md-nav__link">
    6.3 Dining-Philosophers Problem
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-deadlocks" class="md-nav__link">
    7. æ­»é” Deadlocks
  </a>
  
    <nav class="md-nav" aria-label="7. æ­»é” Deadlocks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-system-resource-allocation-graph" class="md-nav__link">
    7.1 èµ„æºåˆ†é…å›¾ system resource-allocation graph
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72" class="md-nav__link">
    7.2 æ­»é”çš„å¿…è¦æ¡ä»¶
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73" class="md-nav__link">
    7.3 é¢„é˜²ï¼Œé“¶è¡Œå®¶ç®—æ³•
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74" class="md-nav__link">
    7.4 é¿å…
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#75" class="md-nav__link">
    7.5 æ£€æµ‹
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#76" class="md-nav__link">
    7.6 æ¢å¤
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../mem_file/" class="md-nav__link">
        å†…å­˜å’Œæ–‡ä»¶ç³»ç»Ÿ
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../objdump/" class="md-nav__link">
        Objdumpå·¥å…·
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../crawler/" class="md-nav__link">
        å†™ä¸ªçˆ¬è™«CrawlerğŸ•·ï¸ï¼
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          DLä¸“æ 
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          DLä¸“æ 
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DL/" class="md-nav__link">
        ç´¢å¼•
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_2" >
      
      
      
        <label class="md-nav__link" for="__nav_4_2" id="__nav_4_2_label" tabindex="0">
          NLP Theory
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_2">
          <span class="md-nav__icon md-icon"></span>
          NLP Theory
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DL/NLPTheory/ling_ebender/" class="md-nav__link">
        E.Bender Ling4NLPè¯»ä¹¦ç¬”è®°
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DL/NLPTheory/cot/" class="md-nav__link">
        CoT Prompt
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DL/NLPTheory/nli/" class="md-nav__link">
        NLI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DL/NLPTheory/embodied_ai/" class="md-nav__link">
        Embodied AI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DL/NLPTheory/explainable_nlp/" class="md-nav__link">
        Explainable NLP
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DL/NLPTheory/mwp/" class="md-nav__link">
        Math Word Problem
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DL/NLPTheory/neural_symbolic/" class="md-nav__link">
        Neural Symbolic AI
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DL/NLPTheory/autoregressive/" class="md-nav__link">
        Autoregressive Decoder
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_3" >
      
      
      
        <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
          NLP Tech
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          NLP Tech
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DL/NLPTech/ml_cheatsheet/" class="md-nav__link">
        MLå…«è‚¡
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DL/NLPTech/transformer_code/" class="md-nav__link">
        Transformerä»£ç 
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DL/NLPTech/bert_code/" class="md-nav__link">
        BERTä»£ç 
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DL/NLPTech/gpt_code/" class="md-nav__link">
        GPTä»£ç 
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DL/NLPTech/llama_code/" class="md-nav__link">
        LLaMaä»£ç 
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DL/NLPTech/cs231n/" class="md-nav__link">
        CS231nç¬”è®°(è¿˜æ²¡å†™)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DL/NLPTech/cs224n/" class="md-nav__link">
        CS224nç¬”è®°(è¿˜æ²¡å†™)
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DL/NLPTech/rule_text/" class="md-nav__link">
        è§„åˆ™æå–æ–‡æœ¬æ ¼å¼æ€»ç»“
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4_4" id="__nav_4_4_label" tabindex="0">
          Pythonç”¨æ³•é€ŸæŸ¥
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_4">
          <span class="md-nav__icon md-icon"></span>
          Pythonç”¨æ³•é€ŸæŸ¥
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DL/Python/ipdb/" class="md-nav__link">
        IPDB
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DL/Python/pandas_dataframe/" class="md-nav__link">
        Pandas DFé€ŸæŸ¥
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DL/Python/python_object/" class="md-nav__link">
        Pythoné¢å‘å¯¹è±¡è¯­æ³•
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DL/Python/setup_pack/" class="md-nav__link">
        Python Setup Packages
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DL/Python/pytorch/" class="md-nav__link">
        Pytorché€ŸæŸ¥
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DL/Python/broadcastable_vector/" class="md-nav__link">
        Broadcastble Vector
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4_5" >
      
      
      
        <label class="md-nav__link" for="__nav_4_5" id="__nav_4_5_label" tabindex="0">
          å‘½ä»¤è¡Œç”¨æ³•é€ŸæŸ¥
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_5">
          <span class="md-nav__icon md-icon"></span>
          å‘½ä»¤è¡Œç”¨æ³•é€ŸæŸ¥
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DL/Terminal/anaconda/" class="md-nav__link">
        Anacondaé€ŸæŸ¥
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DL/Terminal/linux/" class="md-nav__link">
        Linuxå‘½ä»¤è¡Œ
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DL/Terminal/pytorch_terminal/" class="md-nav__link">
        Pytorchå‘½ä»¤è¡Œ
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../DL/Terminal/tmux/" class="md-nav__link">
        tmuxé€ŸæŸ¥
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Lingä¸“æ 
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Lingä¸“æ 
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Ling/" class="md-nav__link">
        ç´¢å¼•
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_2" >
      
      
      
        <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
          è¯­éŸ³å­¦Phonetics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          è¯­éŸ³å­¦Phonetics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Ling/Phonetics/reduction/" class="md-nav__link">
        Reduction in verb.+prep.
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Ling/Phonetics/signal/" class="md-nav__link">
        Signal Basis
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_3" >
      
      
      
        <label class="md-nav__link" for="__nav_5_3" id="__nav_5_3_label" tabindex="0">
          å¥æ³•å­¦Syntax
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_3">
          <span class="md-nav__icon md-icon"></span>
          å¥æ³•å­¦Syntax
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Ling/Syntax/conv_gen/" class="md-nav__link">
        è½¬æ¢ç”Ÿæˆå¥æ³•
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Ling/Syntax/uni_gram/" class="md-nav__link">
        æ™®éè¯­æ³•
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Ling/Syntax/ud_sud/" class="md-nav__link">
        ä¾å­˜å¥æ³•UD&SUD
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_4" >
      
      
      
        <label class="md-nav__link" for="__nav_5_4" id="__nav_5_4_label" tabindex="0">
          è¯­ä¹‰å­¦Semantics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_4">
          <span class="md-nav__icon md-icon"></span>
          è¯­ä¹‰å­¦Semantics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Ling/Semantics/" class="md-nav__link">
        Index
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Ling/Semantics/definitions/" class="md-nav__link">
        Definition Clearification
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Ling/Semantics/formal_semantics/" class="md-nav__link">
        Logics & Formal Semantics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Ling/Semantics/ambiguity/" class="md-nav__link">
        Scope Ambiguity
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_5_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5_5" id="__nav_5_5_label" tabindex="0">
          è¯­ç”¨å­¦Pragmatics
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_5">
          <span class="md-nav__icon md-icon"></span>
          è¯­ç”¨å­¦Pragmatics
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Ling/Pragmatics/ca_da/" class="md-nav__link">
        Research Methods
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Ling/pol_zh/" class="md-nav__link">
        è¯­è¨€å“²å­¦Philosophy of Language
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_6" >
      
      
      
        <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
          Mathä¸“æ 
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_6">
          <span class="md-nav__icon md-icon"></span>
          Mathä¸“æ 
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/" class="md-nav__link">
        ç´¢å¼•
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/Graph/laplace_matrix/" class="md-nav__link">
        å›¾è®º
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/questions/" class="md-nav__link">
        é›¶æ•£çš„é¢˜
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Math/normal_forms/" class="md-nav__link">
        å„ç§Normal Forms
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
        
      
      <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_7" >
      
      
      
        <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
          è¯´çè¯äº†
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          è¯´çè¯äº†
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Other/" class="md-nav__link">
        ç´¢å¼•
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Other/tools/" class="md-nav__link">
        æˆ‘çš„å·¥å…·ç®±ï¼
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Other/apa/" class="md-nav__link">
        APA Format
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../Other/nlp_resources/" class="md-nav__link">
        DL & NLP èµ„æºæ•´ç†
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="ç›®å½•">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      ç›®å½•
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#2-process" class="md-nav__link">
    2. è¿›ç¨‹ Process
  </a>
  
    <nav class="md-nav" aria-label="2. è¿›ç¨‹ Process">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#21" class="md-nav__link">
    2.1 ç»„æˆ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22" class="md-nav__link">
    2.2 è¿›ç¨‹çš„çŠ¶æ€
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-process-control-block-pcb-aka-task-control-block" class="md-nav__link">
    2.3 è¿›ç¨‹æ§åˆ¶å—Process Control Block (PCB, aka. task control block)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-pid" class="md-nav__link">
    2.4 è¿›ç¨‹çš„åˆ›å»ºï¼Œpid
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25" class="md-nav__link">
    2.5 è¿›ç¨‹çš„ç»ˆæ­¢
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#26-ipcinterprocess-communication" class="md-nav__link">
    2.6 è¿›ç¨‹é—´é€šä¿¡IPCï¼ŒInterProcess Communication
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#3-scheduling" class="md-nav__link">
    3. è°ƒåº¦Scheduling
  </a>
  
    <nav class="md-nav" aria-label="3. è°ƒåº¦Scheduling">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#31" class="md-nav__link">
    3.1 è°ƒåº¦çš„æ—¶æœº
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#32-context-switchin" class="md-nav__link">
    3.2 è¿‡ç¨‹ï¼ˆä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œcontext switchinï¼‰
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#33" class="md-nav__link">
    3.3 è°ƒåº¦ç®—æ³•è¯„ä»·
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#34" class="md-nav__link">
    3.4 è°ƒåº¦ç®—æ³•
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#4-threads" class="md-nav__link">
    4. çº¿ç¨‹ threads
  </a>
  
    <nav class="md-nav" aria-label="4. çº¿ç¨‹ threads">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#41" class="md-nav__link">
    4.1 åŠ¨æœºå’Œæ¦‚å¿µ
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#42" class="md-nav__link">
    4.2 ä¼˜ç¼ºç‚¹
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#43" class="md-nav__link">
    4.3 å®ç°æ–¹å¼ï¼šç”¨æˆ·çº§/å†…æ ¸æ€ï¼Œå¤šçº¿ç¨‹æ¨¡å‹
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#5-synchronization" class="md-nav__link">
    5. åŒæ­¥å’ŒåŒæ­¥å·¥å…· Synchronization
  </a>
  
    <nav class="md-nav" aria-label="5. åŒæ­¥å’ŒåŒæ­¥å·¥å…· Synchronization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#51-cs-problem" class="md-nav__link">
    5.1 å¼•å…¥å’ŒCS Problem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#52-petersons-solution" class="md-nav__link">
    5.2 Petersonâ€™s Solution
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#53" class="md-nav__link">
    5.3 ç¡¬ä»¶æŒ‡ä»¤
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#54-semaphores" class="md-nav__link">
    5.4 ä¿¡å·é‡ Semaphores
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#55-atomic-variable" class="md-nav__link">
    5.5 Atomic Variable
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#56-mutex-mutual-exclusion-lock" class="md-nav__link">
    5.6 Mutex (Mutual Exclusion Lock)
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#57-priority-inversion" class="md-nav__link">
    5.7 Priority Inversion
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#6" class="md-nav__link">
    6. ç»å…¸åŒæ­¥é—®é¢˜
  </a>
  
    <nav class="md-nav" aria-label="6. ç»å…¸åŒæ­¥é—®é¢˜">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#61-bounded-buffer-problem" class="md-nav__link">
    6.1 Bounded-buffer Problem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#62-reader-writer-problem" class="md-nav__link">
    6.2 Reader-Writer Problem
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#63-dining-philosophers-problem" class="md-nav__link">
    6.3 Dining-Philosophers Problem
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#7-deadlocks" class="md-nav__link">
    7. æ­»é” Deadlocks
  </a>
  
    <nav class="md-nav" aria-label="7. æ­»é” Deadlocks">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#71-system-resource-allocation-graph" class="md-nav__link">
    7.1 èµ„æºåˆ†é…å›¾ system resource-allocation graph
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#72" class="md-nav__link">
    7.2 æ­»é”çš„å¿…è¦æ¡ä»¶
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#73" class="md-nav__link">
    7.3 é¢„é˜²ï¼Œé“¶è¡Œå®¶ç®—æ³•
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#74" class="md-nav__link">
    7.4 é¿å…
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#75" class="md-nav__link">
    7.5 æ£€æµ‹
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#76" class="md-nav__link">
    7.6 æ¢å¤
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="os-lecture">OS Lecture è¿›ç¨‹ä¸åŒæ­¥</h1>
<h2 id="2-process">2. è¿›ç¨‹ Process</h2>
<h3 id="21">2.1 ç»„æˆ</h3>
<p>è¿›ç¨‹processï¼ˆ=ä½œä¸šjobï¼‰æ˜¯è¢«åŠ è½½åˆ°å†…å­˜ä¸­æ­£åœ¨è¿è¡Œçš„ç¨‹åºã€‚å¤šä¸ªè¿›ç¨‹å¯èƒ½å¯¹åº”åŒä¸€ä¸ªç¨‹åºã€‚ä¸€ä¸ªæ­£åœ¨è¿è¡Œçš„OSä¸­ä¼šæœ‰å¤šä¸ªè¿›ç¨‹ï¼Œè¿›ç¨‹æ˜¯ç¨‹åºçš„ä¸€æ¬¡æ‰§è¡Œè¿‡ç¨‹ï¼Œæ˜¯OSåˆ†é…èµ„æºçš„åŸºæœ¬å•ä½ã€‚</p>
<p>è¿›ç¨‹çš„ç»„æˆï¼šä¸€ä¸ªè¿›ç¨‹åŒ…æ‹¬
- code or text
    - å³ç¨‹åºä»£ç ï¼ŒåŠ è½½åˆ°å†…å­˜å‰ä»¥executable fileçš„å½¢å¼å­˜å‚¨åœ¨diskä¸­
- program counter
    - PCï¼ŒæŒ‡å‘ä¸‹ä¸€ä¸ªè¦è¿è¡Œçš„æŒ‡ä»¤
- counter of the processorâ€™s registers
    - åœ¨è¿›ç¨‹ä¹‹é—´åˆ‡æ¢æ—¶ï¼Œéœ€è¦ä¿å­˜å¯„å­˜å™¨çš„å€¼ä»¥ä¾¿ä¸‹æ¬¡å›åˆ°è¯¥è¿›ç¨‹æ—¶ç»§ç»­è¿è¡Œ
- run time stack
    - åœ¨ICSå’Œæ±‡ç¼–ä¸­å­¦ä¹ è¿‡ç›¸å…³å†…å®¹ï¼Œå…¶ä¸­çš„æ¡ç›®ç§°ä¸ºactivation recordsï¼ˆstack framesï¼‰
    - ç”±ç”¨æˆ·ä»£ç æ§åˆ¶ï¼ˆç¼–è¯‘æ—¶å®Œæˆå…³äºæ ˆçš„ç›¸å…³è°ƒç”¨ï¼‰ï¼Œåœ¨è°ƒç”¨å‡½æ•°æ—¶æš‚æ—¶å­˜å‚¨ä¸€äº›æ•°æ®ï¼Œå¦‚local variables, return address, return values, state of registers, parametersç­‰
- data section
    - global variables
- heap
    - dynamically allocated memory
    <img alt="" src="../asset/OS20.png" /></p>
<h3 id="22">2.2 è¿›ç¨‹çš„çŠ¶æ€</h3>
<p>è¿›ç¨‹åœ¨æ‰§è¡Œ(execute)æ—¶ä¼šæ”¹å˜çŠ¶æ€(state)ï¼š
<img alt="" src="../asset/OS21.png" />
ä¸€ä¸ªå¤„ç†å™¨ï¼Œåªæœ‰ä¸€ä¸ªè¿›ç¨‹å¯ä»¥runningï¼Œæ›´å¤šçš„å¤„äºreadyæˆ–waitingçŠ¶æ€</p>
<h3 id="23-process-control-block-pcb-aka-task-control-block">2.3 è¿›ç¨‹æ§åˆ¶å—Process Control Block (PCB, aka. task control block)</h3>
<p>è¡¨ç¤ºè¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªPCB</p>
<p>PCBåŒ…å«çš„å…³äºå½“å‰è¿›ç¨‹çš„ä¿¡æ¯ï¼š
- process state è¿›ç¨‹çŠ¶æ€
- program counter
- CPU registers è¿›ç¨‹ç›¸å…³çš„å¯„å­˜å™¨çš„å€¼
- CPU scheduling information, properties, scheduling queue pointers, etc.
- Memory-management information
- Accounting information, CPU ä½¿ç”¨æ—¶é—´ï¼Œæ—¶é—´æœŸé™ï¼Œè®°è´¦æ•°æ®ç­‰
- IO status information, åˆ†é…ç»™è¿›ç¨‹çš„IOè®¾å¤‡åˆ—è¡¨ï¼Œæ‰“å¼€æ–‡ä»¶åˆ—è¡¨ç­‰</p>
<p>PCBç»“æ„ç¤ºæ„å›¾
<img alt="" src="../asset/OS22.png" />
ä¸åŒçš„ç³»ç»Ÿå¯èƒ½æœ‰ä¸åŒçš„PCBã€‚Linuxä¸­çš„è¿›ç¨‹ç”¨ç»“æ„ä½“task_structå­˜å‚¨ã€‚</p>
<h3 id="24-pid">2.4 è¿›ç¨‹çš„åˆ›å»ºï¼Œpid</h3>
<p>OSé€šè¿‡ä¸€ä¸ªå”¯ä¸€çš„æ ‡è¯†ç¬¦ï¼ˆprocess identifier, pidï¼‰è¯†åˆ«è¿›ç¨‹ã€‚ä¸€ä¸ªè¿›ç¨‹åœ¨è¿è¡Œæ—¶å¯ä»¥åˆ›å»ºæ–°çš„è¿›ç¨‹ï¼Œåˆ™å®ƒæˆä¸ºçˆ¶è¿›ç¨‹ï¼Œæ–°è¿›ç¨‹ç§°ä¸ºå­è¿›ç¨‹ã€‚</p>
<p>çˆ¶è¿›ç¨‹çš„pidç§°ä¸ºå­è¿›ç¨‹çš„ppidï¼ˆparentâ€™s pidï¼‰â†’ å½¢æˆè¿›ç¨‹æ ‘ï¼ˆprocess treeï¼‰
<img alt="" src="../asset/OS23.png" />
å½“å­è¿›ç¨‹åˆ›å»ºæ—¶ï¼Œéœ€è¦çš„èµ„æºï¼ˆCPUæ—¶é—´ã€å†…å­˜ã€æ–‡ä»¶ã€IOè®¾å¤‡ç­‰ï¼‰å¯ä»¥æ¥è‡ªOSä¹Ÿå¯ä»¥ç»§æ‰¿ï¼ˆå…±äº«ï¼‰è‡ªçˆ¶è¿›ç¨‹ã€‚</p>
<p>UNIXç³»ç»Ÿé€šè¿‡ç³»ç»Ÿè°ƒç”¨fork()åˆ›å»ºæ–°è¿›ç¨‹ï¼Œç›¸å½“äºæ‹·è´äº†ä¸€ä»½çˆ¶è¿›ç¨‹ï¼Œåªæ”¹å˜pidå’Œppidï¼Œç„¶åæŠŠå­è¿›ç¨‹å½“å‰å†…å­˜ä½¿ç”¨è®°å½•è®¾0ã€‚fork()ç»™çˆ¶è¿›ç¨‹è¿”å›å€¼æ˜¯å­è¿›ç¨‹çš„pidï¼Œç»™å­è¿›ç¨‹è¿”å›0ã€‚</p>
<p>ä»£ç æ®µï¼šcreating a separate process using the UNIX fork() system call.</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;sys/types.h&gt;</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;stdio.h&gt;</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="cp">#include</span><span class="w"> </span><span class="cpf">&lt;unist.h&gt;</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="kt">int</span><span class="w"> </span><span class="nf">main</span><span class="p">()</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="p">{</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="w">    </span><span class="kt">pid_t</span><span class="w"> </span><span class="n">pid</span><span class="p">;</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="w">    </span><span class="cm">/* fork a child process */</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="w">    </span><span class="n">pid</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">fork</span><span class="p">();</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pid</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">){</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="w">        </span><span class="cm">/* error occurred */</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="w">        </span><span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;Fork Failed&quot;</span><span class="p">);</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="w">        </span><span class="k">return</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">pid</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#__codelineno-0-16"></a><span class="w">        </span><span class="cm">/* child process */</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#__codelineno-0-17"></a><span class="w">        </span><span class="n">execlp</span><span class="p">(</span><span class="s">&quot;/bin/ls&quot;</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;ls&quot;</span><span class="p">,</span><span class="w"> </span><span class="nb">NULL</span><span class="p">);</span><span class="c1">// å¯¹äºç”¨æˆ·ç»™å‡ºçš„æŒ‡å®šæ–‡ä»¶åï¼Œç¨‹åºä¼šåœ¨å½“å‰PATHç¯å¢ƒå˜é‡ä¸‹æœç´¢</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#__codelineno-0-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#__codelineno-0-19"></a><span class="w">    </span><span class="k">else</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#__codelineno-0-20"></a><span class="w">        </span><span class="cm">/* parent process */</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#__codelineno-0-21"></a><span class="w">        </span><span class="cm">/* parent will wait for the child to complete */</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#__codelineno-0-22"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="nb">NULL</span><span class="p">);</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#__codelineno-0-23"></a><span class="w">        </span><span class="n">printf</span><span class="p">(</span><span class="s">&quot;child complete&quot;</span><span class="p">);</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#__codelineno-0-24"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#__codelineno-0-25"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#__codelineno-0-26"></a><span class="p">}</span>
</span></code></pre></div>
<p>fork() å¦‚ä½•å¯¹çˆ¶è¿›ç¨‹å’Œå­è¿›ç¨‹è¿”å›ä¸åŒçš„å€¼ï¼šå½“åˆ›å»ºæ–°è¿›ç¨‹æ—¶ï¼Œçˆ¶è¿›ç¨‹å¯ä»¥</p>
<ul>
<li>ç»§ç»­è¿è¡Œï¼ˆå’Œå­è¿›ç¨‹å¹¶å‘æ‰§è¡Œï¼Œå³åŒæ—¶æˆ–äº¤æ›¿è¿è¡Œï¼‰æˆ–</li>
<li>ç­‰å¾…å­è¿›ç¨‹è¿è¡Œå®Œåå†è¿è¡Œ</li>
</ul>
<p>å­è¿›ç¨‹çš„åœ°å€ç©ºé—´æœ‰å¯èƒ½</p>
<ul>
<li>ä½¿ç”¨çˆ¶è¿›ç¨‹çš„æ‹·è´æˆ–</li>
<li>åŠ è½½ä¸€ä¸ªæ–°ç¨‹åº</li>
</ul>
<p>ä¸ºä»€ä¹ˆè¦æ‹·è´ä¸€ä»½ï¼Œæœ‰çš„å­è¿›ç¨‹ä¸ä¼šç”¨copyçš„åœ°å€ã€‚æ‰€ä»¥éƒ¨åˆ†UNIXå¼•å…¥äº†copy-on-writeæœºåˆ¶ï¼Œå³å°†åœ°å€ç©ºé—´çš„å¤åˆ¶æ¨è¿Ÿåˆ°éœ€è¦å†™å…¥çš„æ—¶å€™å†è¿›è¡Œã€‚</p>
<p>getpid()å’Œgetppid()å¯ä»¥è·å¾—è¿›ç¨‹çš„pidå’Œppidã€‚</p>
<h3 id="25">2.5 è¿›ç¨‹çš„ç»ˆæ­¢</h3>
<p>è¿›ç¨‹è°ƒç”¨exit()å®ç°ç»ˆæ­¢ã€‚ä¹Ÿæ˜¯Cè¯­è¨€mainå‡½æ•°è¿”å›æ—¶éšå¼è°ƒç”¨çš„ä¸œè¥¿</p>
<p>å½“è¿›ç¨‹ç»ˆæ­¢æ—¶ï¼Œè¿›ç¨‹è¿›å…¥terminatedçŠ¶æ€ï¼Œå…¶èµ„æºè¢«OSå›æ”¶ï¼Œä½†æ˜¯pidï¼Œç»“æŸçŠ¶æ€ï¼Œèµ„æºä½¿ç”¨æƒ…å†µä»ç„¶ä¼šè¢«ä¿å­˜ï¼Œå› ä¸ºçˆ¶è¿›ç¨‹æœ‰å¯èƒ½ä¼šè°ƒç”¨wait()æ¥è·å–ã€‚</p>
<p>zombie processes: å­è¿›ç¨‹å·²ç»ˆæ­¢ï¼Œçˆ¶è¿›ç¨‹è¿˜æ²¡æœ‰è°ƒç”¨wait()</p>
<p>orphan processes: çˆ¶è¿›ç¨‹ç»“æŸäº†ï¼Œå­è¿›ç¨‹æ²¡ç»“æŸã€‚æœ‰äº›OSä¼šæŠŠå­è¿›ç¨‹ç»“æŸæ‰ï¼ŒUNIXä¼šè®©initç§°ä¸ºå…¶çˆ¶è¿›ç¨‹ã€‚</p>
<h3 id="26-ipcinterprocess-communication">2.6 è¿›ç¨‹é—´é€šä¿¡IPCï¼ŒInterProcess Communication</h3>
<p>æ˜¯ä¸ºäº†åœ¨è¿›ç¨‹çš„èµ„æºç›¸äº’éš”ç¦»ï¼ˆï¼Ÿï¼‰çš„æƒ…å†µä¸‹ï¼Œè®©ä¸åŒçš„è¿›ç¨‹èƒ½ç›¸äº’è®¿é—®èµ„æºï¼Œåè°ƒå·¥ä½œã€‚</p>
<ul>
<li>å…±äº«å†…å­˜shared memoryï¼šä¸¤ä¸ªè¿›ç¨‹å„æœ‰ä¸€å—è™šæ‹Ÿå†…å­˜ï¼Œæ˜ å°„åˆ°åŒä¸€å—ç‰©ç†å†…å­˜ã€‚å…±äº«å†…å­˜ä¹Ÿéœ€è¦ä¿¡å·é‡ç­‰åŒæ­¥æ‰‹æ®µä¿æŠ¤ã€‚</li>
<li>æ¶ˆæ¯ä¼ é€’message passing
<img alt="" src="../asset/OS24.png" /></li>
<li>ä¿¡å·é‡semaphoresï¼šæœ¬æ„ç”¨æ¥çº¿ç¨‹é—´åŒæ­¥ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡sem_open()ç³»ç»Ÿè°ƒç”¨æ¥å»ºç«‹å’Œç»´æŠ¤è¿›ç¨‹é—´çš„ä¿¡å·é‡ã€‚</li>
<li>å…±äº«æ–‡ä»¶</li>
<li>ç®¡é“pipeï¼Œä¹Ÿæ˜¯ä¸€ç§æ–‡ä»¶ï¼ŒåŠåŒå·¥ä¿¡é“</li>
<li>æ¶ˆæ¯é˜Ÿåˆ—message queueï¼šæ“ä½œç³»ç»Ÿç»´æŠ¤çš„é“¾è¡¨ï¼Œè¿›ç¨‹å¯ä»¥æ–°å»ºæˆ–è¿æ¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¹¶å†™å…¥æˆ–è¯»å–æ¶ˆæ¯</li>
<li>socketï¼šTCP/UDP</li>
</ul>
<h2 id="3-scheduling">3. è°ƒåº¦Scheduling</h2>
<p>å¤šé“multiprogrammingç¯å¢ƒä¸‹ï¼Œè¿›ç¨‹çš„ä¸ªæ•°é€šå¸¸å¤§äºCPUä¸ªæ•°ã€‚</p>
<p>CPUè°ƒåº¦æ˜¯OSå…³äºå“ªä¸ªreadyè¿›ç¨‹å¯ä»¥è¿è¡Œå’Œè¿è¡Œå¤šä¹…çš„å†³å®šã€‚</p>
<p>å…·ä½“æ¥è®²ä¸€æ¬¡è°ƒåº¦åº”è¯¥æ˜¯æŒ‡OSå°†ä¸€ä¸ªè¿›ç¨‹ä»5ç§çŠ¶æ€ä¸­çš„ä¸€ç§åˆ‡æ¢åˆ°äº†å¦ä¸€ç§çš„è¿‡ç¨‹ã€‚</p>
<p>ç›®æ ‡æ˜¯å§‹ç»ˆå…è®¸æŸä¸ªè¿›ç¨‹è¿è¡Œä»¥æœ€å¤§åŒ–CPUåˆ©ç”¨ç‡ï¼ŒåŒæ—¶ä¿è¯ä¸€å®šå…¬å¹³æ€§ã€‚</p>
<p>è°ƒåº¦ä¸ä¸€å®šæ˜¯CPUè°ƒåº¦ï¼Œæœ‰å¯èƒ½å‘ç”Ÿåœ¨æ‰€æœ‰åœºæ™¯ã€‚</p>
<p>è°ƒåº¦çš„åŸå› æ˜¯èƒ½å¤Ÿä¾›ç»™çš„èµ„æºæ•°é‡è¿œå°äºè¯·æ±‚çš„æ•°é‡ã€‚</p>
<h3 id="31">3.1 è°ƒåº¦çš„æ—¶æœº</h3>
<p>CPUè°ƒåº¦å‡ºç°åœ¨ä»»æ„ä¸€ä¸ªè¿›ç¨‹ï¼Œæœ‰å¦‚ä¸‹5ç§è½¬æ¢</p>
<ul>
<li>running â†’ waiting, å¦‚ç­‰å¾…IO</li>
<li>running â†’ terminated</li>
<li>running â†’ readyï¼Œå½“å‘ç”Ÿäº†ä¸­æ–­ï¼Œå¦‚è®¡æ—¶å™¨æ—¶é—´åˆ°äº†</li>
<li>waiting â†’ readyï¼Œå¦‚IOå®Œæˆäº†</li>
<li>new â†’ ready</li>
</ul>
<p>å¥½çœ‹ä¸€ç‚¹çš„çœ‹å›¾å§
<img alt="" src="../asset/OS25.png" />
è°ƒåº¦æŒ‰æ—¶æœºåˆ†ç±»åˆ†ä¸¤ç§</p>
<ul>
<li>éæŠ¢å å¼è°ƒåº¦nonpreemptiveï¼šåªä¼šåšrunning2waitingæˆ–è€…running2terminatedï¼Œæ­¤æ—¶è¿›ç¨‹ä¸å†è¿è¡Œäº†</li>
<li>æŠ¢å å¼è°ƒåº¦preemptiveï¼šå‘ç”Ÿä¸Šè¿°5ç§</li>
</ul>
<aside>
ğŸ’¡ Qï¼šè°ƒåº¦å’Œä¸­æ–­+å¼‚å¸¸çš„åŒºåˆ«

Aï¼šï¼ˆç”¨æˆ·æ€ï¼‰è°ƒç”¨ï¼ˆè¿›ç¨‹ï¼‰ï¼Œç›®æ ‡æ˜¯è¿›ç¨‹çŠ¶æ€å˜åŒ–ï¼›ï¼ˆå†…æ ¸æ€ï¼‰å¯¹ï¼ˆç”¨æˆ·æ€ï¼‰åštrapï¼Œç›®æ ‡æ˜¯è°ç”¨CPU

Aï¼šå…¶å®ä¸­æ–­ç¨‹åºä¹Ÿå¯ä»¥æ˜¯ä¸€ä¸ªè¿›ç¨‹

åœ¨æ­¤è‡´è°¢ @isshikiä¿® å’Œ @vinci çš„å›ç­”

</aside>

<h3 id="32-context-switchin">3.2 è¿‡ç¨‹ï¼ˆä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œcontext switchinï¼‰</h3>
<p>è°ƒåº¦çš„è¿‡ç¨‹å°±æ˜¯ä¸Šä¸‹æ–‡åˆ‡æ¢ï¼Œæ„Ÿè§‰è¿™ä¸ªåå­—è¯´çš„æ˜¯å¯¹äºæ­£åœ¨è¿è¡Œçš„CPUé‡Œçš„è¿›ç¨‹ï¼Œæ‰€è°“ä¸Šä¸‹æ–‡å°±æ˜¯PCBå†…å®¹ã€‚
<img alt="" src="../asset/OS26.png" /></p>
<h3 id="33">3.3 è°ƒåº¦ç®—æ³•è¯„ä»·</h3>
<ul>
<li>Maximize CPU utilization CPUä½¿ç”¨ç‡ï¼šå³CPUéç©ºé—²çš„æ—¶é—´æ¯”ä¾‹</li>
<li>Maximize Throughput ååé‡ï¼šæ¯ä¸ªæ—¶é—´å•å…ƒå†…å®Œæˆçš„è¿›ç¨‹</li>
<li>Minimize Turnaround Time å‘¨è½¬æ—¶é—´ï¼šä»è¿›ç¨‹åˆ›ç«‹åˆ°è¿›ç¨‹å®Œæˆçš„æ—¶é—´ï¼Œç­‰å¾…è¿›å…¥å†…å­˜+åœ¨ready queueç­‰å¾…+åœ¨CPUä¸Šæ‰§è¡Œ+IOæ‰§è¡Œ+â€¦</li>
<li>Minimize Waiting Time ç­‰å¾…æ—¶é—´ï¼šåœ¨ready queueä¸­ç­‰å¾…æ‰€èŠ±çš„æ—¶é—´ä¹‹å’Œ</li>
<li>Minimize Response Time å“åº”æ—¶é—´ï¼šäº¤äº’ç³»ç»Ÿä»è¿›ç¨‹åˆ›ç«‹åˆ°ç¬¬ä¸€æ¬¡äº§ç”Ÿå“åº”çš„æ—¶é—´</li>
</ul>
<p>è¿™äº›ç›®æ ‡å¯èƒ½çš„å†²çªï¼š
- context switch vs. throughput
- context switch vs. response time</p>
<h3 id="34">3.4 è°ƒåº¦ç®—æ³•</h3>
<p>First-come first-serve (FCFS) | Nonpreemptive</p>
<p>å…ˆç”³è¯·CPUçš„è¿›ç¨‹å…ˆç”¨ï¼Œå¯ä»¥ç”¨ä¸€ä¸ªFIFOé˜Ÿåˆ—å®ç°ã€‚</p>
<p>å®ƒä¼šå¯¼è‡´convey effort: short process behind long process, å°¤å…¶æ˜¯å½“æœ‰çº¿ç¨‹è¿›å…¥waitingåï¼Œå†è¿”å›çš„æ—¶å€™åˆè¦é‡æ–°æ’é˜Ÿã€‚</p>
<p>Shortest-job-first (SJF)</p>
<p>SJFçš„æ ¸å¿ƒæƒ³æ³•æ˜¯è®©ä¸‹ä¸€æ¬¡è¿è¡Œæ—¶é—´æœ€çŸ­çš„è¿›ç¨‹å…ˆæ¥è¿è¡Œ â‡’ èƒ½å¾—åˆ°æœ€å°‘çš„å¹³å‡ç­‰å¾…æ—¶é—´</p>
<p>ä¸‹ä¸€æ¬¡è¿è¡Œæ—¶é—´ = ï¼ˆéæŠ¢å å¼è°ƒåº¦ï¼‰è¿›ç¨‹æ€»æ—¶é—´ï¼ˆå› ä¸ºè¿›ç¨‹ä¸å¯èƒ½è¢«æ‰“æ–­ï¼‰=ï¼ˆæŠ¢å å¼è°ƒåº¦ï¼‰è¿›ç¨‹çš„å‰©ä½™è¿è¡Œæ—¶é—´</p>
<p>ä¼šåˆ†å¼€è®¡ç®—å°±è¡Œ</p>
<p>SJFåœ¨ä¸¤ç§è°ƒåº¦æ–¹æ³•éƒ½èƒ½è·å¾—æœ€å°å¹³å‡ç­‰å¾…æ—¶é—´</p>
<p>é—®é¢˜æ˜¯æˆ‘ä»¬ä¸çŸ¥é“ä¸‹ä¸€æ¬¡è¿è¡Œæ—¶é—´ â†’ æ‰€ä»¥è¦çŒœï¼ŒçŒœçš„ç®—æ³•æ˜¯ä¹‹å‰CPUæ‰§è¡Œé•¿åº¦çš„æŒ‡æ•°å¹³å‡</p>
<p>Round-robin (RR) in preemptive</p>
<p>åšæ³•ï¼šå®šä¹‰ä¸€ä¸ªæ—¶é—´ç‰‡ï¼ˆtime slice/time quantumï¼‰ï¼Œå³ä¸€ä¸ªå›ºå®šçš„è¾ƒå°çš„æ—¶é—´å•å…ƒï¼Œå¦‚æœprocessä¸æ˜¯å”¯ä¸€åœ¨ready queueä¸­çš„è¿›ç¨‹ï¼Œé‚£å°±ä¸ä¼šè¿ç»­è¿è¡Œè¶…è¿‡ä¸€ä¸ªæ—¶é—´ç‰‡çš„æ—¶é—´ã€‚ready queueæ˜¯FIFOçš„ã€‚</p>
<p>æ€§èƒ½ï¼šæ¯”èµ·SJFå¹³å‡ç­‰å¾…æ—¶é—´æ›´é•¿ï¼Œä½†æ˜¯é™ä½äº†response timeã€‚æ€§èƒ½å¥½ååŸºæœ¬ä¸Šå–å†³äºæ—¶é—´ç‰‡å¤§å°ï¼Œresponse timeå’Œoverheadå†²çªã€‚å¦‚æœæ—¶é—´ç‰‡â†’infï¼Œç›¸å½“äºRRâ†’FCFS</p>
<p>æ—¶é—´ç‰‡ä¸€èˆ¬ç”¨10~100ms, context-switchä¸€èˆ¬èŠ±10mius</p>
<p>Priority Scheduling</p>
<p>ä¼˜å…ˆè°ƒåº¦ä¼˜å…ˆçº§æœ€é«˜çš„è¿›ç¨‹ï¼ˆæ ¹æ®è¯¾æœ¬çš„ä¾‹å­ï¼Œä¼˜å…ˆçº§å¥½åƒæ˜¯ä¸ä¼šé‡å¤çš„ï¼‰</p>
<p>ä¼˜å…ˆçº§æ ‡å‡†ï¼š</p>
<ul>
<li>internal: ä¸€äº›æµ‹é‡æ•°æ®ï¼Œå¦‚SJFæ˜¯priorityçš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œå³ä¼˜å…ˆçº§ç”±CPUé¢„æµ‹è¿è¡Œæ—¶é—´å†³å®š</li>
<li>external: ç”¨æˆ·æŒ‡å®š</li>
</ul>
<p>å¯ä»¥ç”¨priority queueå®ç°</p>
<p>å¯ä»¥ä¸RRç»“åˆï¼Œè¿™æ—¶å€™ready queueæ˜¯ç”¨priority queueå®ç°çš„</p>
<p>Priority Agingï¼šè§£å†³indefinite blocking / starvationï¼Œå³ä½ä¼˜å…ˆçº§çš„è¿›ç¨‹å¯èƒ½æ°¸è¿œä¸ä¼šè¢«æ‰§è¡Œã€‚å¯ä»¥æ ¹æ®ç­‰å¾…æ—¶é—´é€æ¸å¢åŠ priorityã€‚</p>
<p>Multilevel Queue Scheduling</p>
<p>å¯ä»¥å°†è¿›ç¨‹åˆ†ä¸ºä¸åŒçš„ç»„ï¼Œæ¯ä¸ªç»„å†…æœ‰ä¸åŒè°ƒåº¦ç®—æ³•çš„ready queueï¼Œç»„å’Œç»„ä¹‹é—´ä¹Ÿè¦è°ƒåº¦ã€‚</p>
<p>ç»„å†…ï¼šä¸€èˆ¬å‰å°é˜Ÿåˆ—ä½¿ç”¨RRä»¥ä¿è¯responseï¼Œåå°å¯ä»¥FCFS</p>
<p>ç»„é—´ï¼šé€šå¸¸ç»™é˜Ÿåˆ—è®¾ç½®ä¼˜å…ˆçº§ï¼Œç”¨preemptive priority schedulingã€‚ä¹Ÿå¯ä»¥ä½¿ç”¨ç»„é—´time-slicing</p>
<p>Multilevel Feedback Queue Scheduling</p>
<p>ä¸Šä¸€ä¸ªç‰ˆæœ¬çš„åŠ å¼ºç‰ˆã€‚å…è®¸è¿›ç¨‹åœ¨ç»„é—´è¿ç§»ã€‚</p>
<p>è¿‡ç¨‹</p>
<ul>
<li>æŒ‰ç…§FCFSåŸåˆ™ï¼Œè®¾ç½®Nä¸ªå°±ç»ªé˜Ÿåˆ—ä¸ºQ1ï¼ŒQ2ï¼Œâ€¦QNï¼Œæ¯ä¸ªé˜Ÿåˆ—ä¹‹é—´å¯ä»¥æ”¾å¾ˆå¤šä½œä¸š</li>
<li>ä¸ºNä¸ªå°±ç»ªé˜Ÿåˆ—èµ‹äºˆä¸åŒä¼˜å…ˆçº§ï¼Œç¬¬ä¸€ä¸ªé˜Ÿåˆ—ä¼˜å…ˆçº§æœ€é«˜ï¼Œç¬¬äºŒä¸ªé˜Ÿåˆ—æ¬¡ä¹‹ï¼Œå…¶ä½™é€ä¸ªé™ä½</li>
<li>è®¾ç½®æ¯ä¸ªå°±ç»ªæ—¶é—´ç‰‡ä¼˜å…ˆæƒè¶Šé«˜ï¼Œç®—æ³•èµ‹äºˆé˜Ÿåˆ—çš„æ—¶é—´ç‰‡è¶Šå°ã€‚æŒ‰ç…§å®é™…ä½œä¸šï¼ˆè¿›ç¨‹ï¼‰çš„éœ€è¦è°ƒæ•´</li>
<li>è¿›ç¨‹ç­‰å¾…æ—¶é¦–å…ˆè¿›å…¥å¾…è°ƒåº¦çš„é˜Ÿåˆ—ç­‰å¾…æ—¶ï¼Œé¦–å…ˆè¿›å…¥ä¼˜å…ˆçº§æœ€é«˜çš„Q1ç­‰å¾…</li>
<li>é¦–å…ˆè°ƒåº¦ä¼˜å…ˆçº§æœ€é«˜çš„é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹ï¼Œè‹¥é«˜ä¼˜å…ˆçº§ä¸­é˜Ÿåˆ—ä¸­æ²¡æœ‰å·²è°ƒåº¦çš„è¿›ç¨‹ï¼Œåˆ™è°ƒåº¦æ¬¡ä¼˜å…ˆé˜Ÿåˆ—ä¸­çš„è¿›ç¨‹</li>
<li>å¯¹äºä¸€ä¸ªé˜Ÿåˆ—ä¸­çš„å„ä¸ªè¿›ç¨‹ï¼ŒæŒ‰ç…§ï¼ˆæ—¶é—´ç‰‡è½®è½¬å»è°ƒåº¦ï¼‰ï¼Œæ¯”å¦‚Q1çš„æ—¶é—´ç‰‡ä¸ºNï¼Œé‚£ä¹ˆQ1çš„ä½œä¸šåœ¨ç»å†äº†æ—¶é—´ç‰‡ä¸ºNçš„æ—¶é—´åï¼Œè‹¥è¿˜æ²¡æœ‰å®Œæˆï¼Œåˆ™è¿›å…¥Q2ï¼Œè¿™æ ·ä¸€ç›´è¿›å…¥ä¸‹ä¸€çº§ï¼Œç›´åˆ°æœ€åä¸€çº§æ˜¯FCFS</li>
<li>åœ¨ä½ä¼˜å…ˆçº§çš„é˜Ÿåˆ—ä¸­çš„è¿›ç¨‹åœ¨è¿è¡Œæ—¶ï¼Œåˆåˆ°è¾¾æ–°çš„ä½œä¸šï¼Œé‚£åœ¨è¿è¡Œå®Œè¿™ä¸ªæ—¶é—´ç‰‡åï¼ŒCPUé©¬ä¸Šåˆ†é…ç»™æ–°åˆ°è¾¾çš„ä½œä¸šå³æŠ¢å å¼è°ƒåº¦CPU</li>
</ul>
<p>è¿™ç§ç®—æ³•çš„performanceæ ¹æ®å…·ä½“æ“ä½œç³»ç»Ÿå’Œå…·ä½“å®ç°è€Œå¼‚ã€‚
<img alt="" src="../asset/OS27.png" /></p>
<h2 id="4-threads">4. çº¿ç¨‹ threads</h2>
<h3 id="41">4.1 åŠ¨æœºå’Œæ¦‚å¿µ</h3>
<p>å¼€é”€ï¼š</p>
<ul>
<li>è¿›ç¨‹åœ¨forkï¼ˆåˆ›å»ºï¼‰çš„æ—¶å€™æœ‰è¾ƒå¤§çš„å¼€é”€</li>
<li>ä¸Šä¸‹æ–‡åˆ‡æ¢æœ‰è¾ƒå¤§çš„å¼€é”€</li>
</ul>
<p>å› ä¸ºè‹¥å¹²è¿›ç¨‹å¯èƒ½å…±äº«ä¸€äº›å†…å®¹ï¼Œå¦‚æœOSçŸ¥é“è¿™äº›å…±äº«ï¼Œå°±èƒ½å‡å°‘æ–°å»ºè¿›ç¨‹çš„å¼€é”€åŠè¿›ç¨‹åˆ‡æ¢çš„æ—¶å»¶ã€‚</p>
<p>â‡’ å¼•å…¥çº¿ç¨‹threadsï¼Œçº¿ç¨‹å±äºè¿›ç¨‹</p>
<p>å®ƒä¹Ÿæœ‰thread id (tid), PC, register set å’Œ runtime stackã€‚</p>
<p>çº¿ç¨‹ä¸åŒä¸€è¿›ç¨‹çš„å…¶å®ƒçº¿ç¨‹å…±äº«code section, data section, heap, open files, signals</p>
<p>Linuxä¸­çº¿ç¨‹ä¹Ÿå«è½»é‡çº§è¿›ç¨‹Light Weight Processã€‚</p>
<p>å¦‚æœOSæ”¯æŒçº¿ç¨‹ï¼Œé‚£è°ƒåº¦çš„å°±æ˜¯å†…æ ¸çº§çº¿ç¨‹è€Œä¸æ˜¯è¿›ç¨‹ï¼Œä¹Ÿå°±æ˜¯è¯´çº¿ç¨‹æ˜¯è¿è¡Œä»¥åŠCPUè°ƒåº¦çš„åŸºæœ¬å•å…ƒã€‚</p>
<p>åŒºåˆ†ï¼šè¿›ç¨‹æ˜¯åˆ†é…èµ„æºçš„åŸºæœ¬å•å…ƒ</p>
<h3 id="42">4.2 ä¼˜ç¼ºç‚¹</h3>
<p>å¤šçº¿ç¨‹ç¼–ç¨‹Multi-Threaded Programmingçš„ä¼˜ç‚¹æœ‰ï¼š</p>
<ul>
<li>economyï¼šå»ºç«‹çº¿ç¨‹ç»æµï¼Œå› ä¸ºcode data heapéƒ½å·²ç»åœ¨å†…å­˜é‡Œäº†ï¼ˆä¸ç”¨å†copyï¼Ÿï¼‰ï¼Œå¦å¤–åŒä¸€è¿›ç¨‹çš„çº¿ç¨‹ä¹‹é—´context switchä¹Ÿä¼šæ›´å¿«ï¼Œå› ä¸ºä¸ç”¨flush cacheã€‚</li>
<li>resource sharingï¼šåŒä¸€è¿›ç¨‹çš„çº¿ç¨‹ä¹‹é—´å¤©ç„¶å…±äº«å†…å­˜ï¼Œå› æ­¤æ— éœ€ä¸ºä¹‹ç¼–å†™IPCï¼Œä¹Ÿå…è®¸å¯¹åŒä¸€å—å†…å­˜è¿›è¡Œå¹¶è¡Œå¤„ç†ã€‚</li>
<li>responsivenessï¼šå¤šçº¿ç¨‹è¿›ç¨‹ä¼šæœ‰æ›´å¥½çš„å“åº”æ€§ã€‚</li>
<li>scalabilityï¼šå¤šå¤„ç†å™¨çš„ä½“ç³»ç»“æ„ä¸Šå¤šçº¿ç¨‹è¿›ç¨‹å¯ä»¥æ›´å¥½å‘æŒ¥ä½œç”¨ï¼Œå› ä¸ºæ¯ä¸€ä¸ªçº¿ç¨‹è¿è¡Œåœ¨ä¸€ä¸ªå¤„ç†å™¨ä¸Šï¼Œå¯¹æ¯”å•çº¿ç¨‹è¿›ç¨‹åªèƒ½è¿è¡Œåœ¨ä¸€ä¸ªå¤„ç†å™¨ä¸Šã€‚</li>
</ul>
<p>ç¼ºç‚¹</p>
<ul>
<li>ä¸€ä¸ªçº¿ç¨‹å‡ºç°é”™è¯¯ï¼Œæ•´ä¸ªè¿›ç¨‹éƒ½ä¼šå»ä¸–ï¼ˆæ¯”å¦‚æµè§ˆå™¨ä¸€ä¸ªç½‘é¡µæŒ‚æ‰ä½¿æ•´ä¸ªæµè§ˆå™¨æŒ‚æ‰ï¼‰</li>
<li>OSå¯¹æ¯ä¸ªè¿›ç¨‹åœ°å€ç©ºé—´å¤§å°é™åˆ¶ï¼Œä½†å¤šçº¿ç¨‹ä¼šå æ›´å¤šå†…å­˜</li>
<li>å…±äº«å†…å­˜ä½¿å†…å­˜ä¿æŠ¤å˜å¤æ‚</li>
</ul>
<h3 id="43">4.3 å®ç°æ–¹å¼ï¼šç”¨æˆ·çº§/å†…æ ¸æ€ï¼Œå¤šçº¿ç¨‹æ¨¡å‹</h3>
<p><img alt="" src="../asset/OS28.png" />
- ç”¨æˆ·çº§çº¿ç¨‹user-level threadï¼šåœ¨OSä¸Šåªæ˜¯ä¸€ä¸ªè¿›ç¨‹ï¼Œè¿™ä¸ªè¿›ç¨‹åŒ…å«çº¿ç¨‹åº“thread libraryï¼Œè´Ÿè´£çº¿ç¨‹çš„åˆ›å»ºå’Œåˆ‡æ¢ï¼›å†…æ ¸çº§çº¿ç¨‹ç”±OSæ”¯æŒè¿™äº›æ“ä½œ
    - ç”¨æˆ·é€šè¿‡OSæä¾›çš„çº¿ç¨‹åº“å‡½æ•°åˆ›å»ºï¼Œ
    - ä¼˜ç‚¹ï¼š1ï¼‰ä¸å ç”¨OSçš„tidï¼Œç†è®ºä¸Šå¯ä»¥æ”¯æŒæ¯”å†…æ ¸çº§çº¿ç¨‹æ›´å¤šçš„çº¿ç¨‹æ•° 2ï¼‰è°ƒåº¦ç­‰æ“ä½œåœ¨ç”¨æˆ·æ€ï¼Œä¸éœ€è¦è¿›å…¥å†…æ ¸æ€ 3ï¼‰å®¹æ˜“å®ç°è‡ªå®šä¹‰çš„è°ƒåº¦ç®—æ³•
    - ç¼ºç‚¹ï¼š1ï¼‰ä¸€æ—¦å½“å‰æ­£åœ¨è¿è¡Œçš„çº¿ç¨‹é˜»å¡ï¼Œé‚£ä¹ˆOSçœ‹æ¥å°±æ˜¯æ•´ä¸ªè¿›ç¨‹è¢«é˜»å¡äº†ï¼Œå°±ä¼šè®¤ä¸ºè¯¥è¿›ç¨‹çš„å…¶å®ƒçº¿ç¨‹ä¹Ÿé˜»å¡äº†ã€‚å¦‚æœæ˜¯å†…æ ¸çº§çº¿ç¨‹å°±åªé˜»å¡è¿™ä¸ªçº¿ç¨‹ 2ï¼‰åŒä¸€ä¸ªè¿›ç¨‹ä¸­çš„å¤šä¸ªç”¨æˆ·çº§çº¿ç¨‹æ— æ³•åœ¨å¤šæ ¸ä¸Šåˆ†åˆ«è¿è¡Œ
- å†…æ ¸çº§çº¿ç¨‹kernel-level threadï¼š</p>
<p>å¤šçº¿ç¨‹æ¨¡å‹ï¼šæœ‰çš„OSåŒæ—¶æ”¯æŒç”¨æˆ·çº§å’Œå†…æ ¸çº§ï¼Œæœ‰å‡ ç§ç”¨æˆ·çº§å’Œå†…æ ¸çº§çš„æ˜ å°„æ–¹æ³•</p>
<p>ï¼ˆ1ï¼‰ç­‰äºåªæ”¯æŒç”¨æˆ·çº§
<img alt="" src="../asset/OS29.png" />
ï¼ˆ2ï¼‰ç­‰äºåªæ”¯æŒå†…æ ¸çº§
<img alt="" src="../asset/OS210.png" />
ï¼ˆ3ï¼‰mä¸ªç”¨æˆ·çº§å¯ä»¥æ˜ å°„åˆ°nä¸ªå†…æ ¸çº§
<img alt="" src="../asset/OS211.png" />
Linuxçº¿ç¨‹ï¼šæ²¡æœ‰ç‰¹åˆ«åŒºåˆ†è¿›ç¨‹å’Œçº¿ç¨‹ï¼Œéƒ½æ˜¯å«task</p>
<p>ä¸çŸ¥é“è¿™é‡Œè€ƒä¸è€ƒè¦æ˜¯è€ƒäº†å›å»referä¸€ä¸‹</p>
<p><a href="https://xuan-insr.github.io/%E6%A0%B8%E5%BF%83%E7%9F%A5%E8%AF%86/os/II_process_management/5_thread/">5 çº¿ç¨‹ - å’¸é±¼æš„çš„ä»£ç ç©ºé—´ (xuan-insr.github.io)</a></p>
<h2 id="5-synchronization">5. åŒæ­¥å’ŒåŒæ­¥å·¥å…· Synchronization</h2>
<p>Synchronizationå°±æ˜¯è§„å®šè¿›ç¨‹æ‰€åšçš„å·¥ä½œä¹‹é—´çš„é¡ºåºæˆ–è€…å…ˆåºå…³ç³»ï¼Œä»è€Œé˜²æ­¢ä¸€äº›éæ³•æƒ…å†µå‘ç”Ÿçš„æ–¹æ³•ã€‚</p>
<h3 id="51-cs-problem">5.1 å¼•å…¥å’ŒCS Problem</h3>
<p>Cooperation processæ˜¯å¯ä»¥å½±å“ç³»ç»Ÿä¸­å…¶å®ƒè¿è¡Œè¿›ç¨‹æˆ–è¢«å…¶å®ƒè¿›ç¨‹å½±å“çš„è¿›ç¨‹ã€‚</p>
<p>Cooperating Systemä¼š</p>
<ul>
<li>å…±åŒä½¿ç”¨ä¸€äº›æ•°æ®ï¼Œå¯èƒ½æ˜¯ç›´æ¥ä½¿ç”¨åŒä¸€æ®µåœ°å€ç©ºé—´ï¼ˆä»£ç +æ•°æ®ï¼‰ï¼Œæˆ–è€…æ˜¯é€šè¿‡å…±äº«çš„å†…å­˜æˆ–ä¿¡æ¯å…±ç”¨ä¸€äº›æ•°æ®</li>
<li>å¯¹æ•°æ®çš„åŒæ—¶è®¿é—®concurrent accesså¯èƒ½ä¼šå¯¼è‡´data inconsistencyï¼Œå› ä¸ºæ•°æ®çš„ä¸€è‡´æ€§éœ€è¦cooperating processæœ‰åºçš„è¿è¡Œ</li>
</ul>
<p>e.g. Bounded-buffer problem</p>
<p>ç»™å®šä¸¤ä¸ªè¿›ç¨‹producerå’Œconsumerï¼Œå…±ç”¨å¤§å°ä¸ºnçš„bufferã€‚</p>
<p>producerç”Ÿäº§æ•°æ®æ”¾å…¥bufferï¼Œconsumerä»bufferä¸­ä½¿ç”¨æ•°æ®</p>
<p>é™å®šæ¡ä»¶ï¼šproducerä¸åº”åœ¨bufferæ»¡æ—¶æ”¾å…¥æ•°æ®ï¼Œconsumerä¹Ÿä¸åº”å½“åœ¨bufferç©ºæ—¶å–å‡ºæ•°æ®</p>
<p>æƒ³è±¡ä¸­çš„ä¸¤ä¸ªè¿›ç¨‹</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a><span class="cm">/* producer process */</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">){</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">    </span><span class="cm">/* produce an item in nert_produced */</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">BUFFER_SIZE</span><span class="p">)</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">        </span><span class="p">;</span><span class="w"> </span><span class="cm">/* do nothing */</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">    </span><span class="n">buffer</span><span class="p">[</span><span class="n">in</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">next_produced</span><span class="p">;</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">    </span><span class="n">in</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">in</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">BUFFER_SIZE</span><span class="p">;</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">    </span><span class="n">count</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="p">}</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="cm">/* Consumer Process */</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">){</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">count</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">        </span><span class="p">;</span><span class="w"> </span><span class="cm">/* do nothing */</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">    </span><span class="n">next_consumed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">buffer</span><span class="p">[</span><span class="n">out</span><span class="p">];</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">    </span><span class="n">out</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">out</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">BUFFER_SIZE</span><span class="p">;</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="w">    </span><span class="n">count</span><span class="w"> </span><span class="o">--</span><span class="p">;</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="w">    </span><span class="cm">/* consume the item in next_consumed */</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="p">}</span>
</span></code></pre></div>
<p>å¦‚æœcountçš„å€¼æ˜¯é”™è¯¯çš„ï¼Ÿ
<img alt="" src="../asset/OS2x.png" />
ä¾‹å­çš„æ„æ€æ˜¯ï¼Œ++å’Œâ€”éƒ½æ˜¯ç³»ç»Ÿå®ç°çš„ï¼Œå¦‚æœå…±ç”¨countè¯»å–çš„æ—¶é—´æ°å¥½æ’ä¸Šï¼Œcountçš„å€¼å°±ä¸å¯¹</p>
<p>å‡ºç°è¿™ç§æƒ…å†µçš„åŸå› æ˜¯æˆ‘ä»¬å…è®¸ä¸¤ä¸ªè¿›ç¨‹åŒæ—¶æ“çºµå˜é‡countã€‚</p>
<p>e.g. kernelä¸­ï¼šä¸¤ä¸ªè¿›ç¨‹ P0Â å’Œ P1Â åŒæ—¶Â <code>fork()</code>Â æ—¶ï¼Œå¦‚æœä¸åŠ é™åˆ¶ï¼Œå¯èƒ½ä¼šå‡ºç°ç±»ä¼¼å‰ä¾‹çš„æƒ…å†µï¼Œå³åœ¨æŸä¸€ä¸ªè¿›ç¨‹æŠŠå½“å‰çš„Â <code>next_avaliable_pid</code>Â åˆ†é…ç»™ä»–çš„ child åï¼Œåœ¨æ²¡æ¥å¾—åŠæ›´æ–°Â <code>next_avaliable_pid</code>Â å‰ï¼Œå¦ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨äº†Â <code>next_avaliable_pid</code>Â æ¥ç»™ child åˆ†é… PIDï¼Œè¿™å°±ä¼šå¯¼è‡´ä¸¤ä¸ªä¸åŒçš„çº¿ç¨‹ä½¿ç”¨åŒä¸€ä¸ª PID çš„æƒ…å†µã€‚</p>
<p><strong>Race Condition</strong>ï¼šå¤šä¸ªè¿›ç¨‹åŒæ—¶æ“æ§ä¸€ä¸ªæ•°æ®ï¼Œç”±æ“æ§å‡ºç°çš„é¡ºåºå†³å®šç»“æœ</p>
<p>å¿…é¡»ä¿è¯åŒä¸€ä¸ªæ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªè¿›ç¨‹æ“æ§æŸä¸ªå˜é‡ã€‚</p>
<p>The Critical-Section Problem ï¼ˆCS Problemï¼‰</p>
<p>è€ƒè™‘ä¸€ä¸ªæœ‰nä¸ªè¿›ç¨‹çš„ç³»ç»Ÿï¼Œæ¯ä¸ªè¿›ç¨‹ä¸­éƒ½æœ‰ä¸€æ®µä»£ç å¯èƒ½ä¿®æ”¹å…¶ä»–è‡³å°‘ä¸€ä¸ªè¿›ç¨‹å…¬ç”¨çš„æ•°æ®ï¼Œç§°ä¸ºcritical sectionã€‚è¿™ä¸ªç³»ç»Ÿéœ€è¦æ»¡è¶³çš„é‡è¦æ€§è´¨æ˜¯ï¼Œå½“ä¸€ä¸ªè¿›ç¨‹æ­£åœ¨è¿è¡Œcritical sectionæ—¶ï¼Œå…¶å®ƒè¿›ç¨‹éƒ½ä¸èƒ½è¿›å…¥critical section</p>
<p>å°†è¿™ä¸ªé—®é¢˜ç§°ä¸ºcritical section problemï¼Œä¹Ÿå°±æ˜¯è¦è®¾è®¡ä¸€ç§è¾¾æˆä¸€è‡´è¡Œçš„æ–¹æ³•ã€‚æˆ–è€…è¯´è®¾è®¡ä¸€ç§è®©å„ç§è¿›ç¨‹åŒæ­¥ä»è€Œå®‰å…¨å…±äº«æ•°æ®çš„åè®®ã€‚</p>
<p>è¿™æ®µç¨‹åºçš„ç¤ºæ„å›¾å¦‚ä¸‹ï¼š
<img alt="" src="../asset/OS212.png" />
æ¯ä¸ªè¿›ç¨‹å¿…é¡»åœ¨entry sectionä¸­ç”³è¯·è¿›å…¥critical sectionçš„è®¸å¯ï¼›åœ¨critical sectionè¿è¡Œç»“æŸåè¿›å…¥exit sectionï¼Œåœ¨è¿™é‡Œè®¸å¯è¢«é‡Šæ”¾ã€‚</p>
<p>â—â—â—</p>
<p>Critical section problemçš„è§£å†³æ–¹æ³•å¿…é¡»æ»¡è¶³å¦‚ä¸‹ä¸‰ä¸ªè¦æ±‚</p>
<ul>
<li>Mutual exclusionï¼šæ²¡æœ‰ä¸¤ä¸ªè¿›ç¨‹å¯ä»¥åŒæ—¶åœ¨è¿è¡Œcritical section</li>
<li>Progressï¼šç³»ç»Ÿæ•´ä½“ä¸Šæ˜¯åœ¨è¿è¡Œçš„<ul>
<li>è¦ä¹ˆæœ‰ä¸€ä¸ªè¿›ç¨‹åœ¨è¿è¡Œå®ƒçš„critical section</li>
<li>è¦ä¹ˆæ²¡æœ‰è¿›ç¨‹åœ¨critical section</li>
<li>è¦ä¹ˆæœ‰é™æ—¶é—´å†…è¦æœ‰ä¸€ä¸ªè¿›ç¨‹è¢«é€‰å…¥å®ƒçš„critical section</li>
</ul>
</li>
<li>Bounded waitingï¼šä»»ä½•ä¸€ä¸ªè¿›ç¨‹ç­‰å¾…è¿›å…¥critical sectionçš„æ—¶é—´æ˜¯æœ‰é™çš„ã€‚å³å½“ä¸€ä¸ªè¿›ç¨‹è¿›å…¥critical sectionçš„è¯·æ±‚åï¼Œåªæœ‰æœ‰é™ä¸ªï¼ˆæ¬¡ï¼‰è¿›ç¨‹ä¼šåœ¨å®ƒä¹‹å‰è¿›å…¥critical sectionã€‚</li>
</ul>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ä»‹ç»çš„ç®—æ³•éƒ½æ˜¯åœ¨ä¸€æ­¥ä¸€æ­¥æ»¡è¶³è¿™ä¸‰ä¸ªè¦æ±‚</p>
<p>Kernelä¸­çš„CS Problem</p>
<ul>
<li>å¯¹äºå•æ ¸ç³»ç»Ÿï¼šå¯ä»¥åœ¨entry sectionä¸­ï¼Œå¯¹critical sectionç¦æ­¢ä¸­æ–­ï¼Œç„¶ååœ¨exit sectionä¸­æ¢å¤</li>
<li>å¯¹äºå¤šæ ¸ç³»ç»Ÿï¼šä¸­æ–­æ¶ˆæ¯éœ€è¦ä¼ åˆ°æ‰€æœ‰å¤„ç†å™¨ï¼Œæ¶ˆæ¯ä¼ é€’ä¼šå»¶è¿Ÿè¿›å…¥ä¸´ç•ŒåŒºï¼Œä¼šé™ä½æ•ˆç‡ã€‚åŒæ—¶ä¹Ÿå½±å“æ—¶é’Ÿä¸­æ–­ã€‚</li>
</ul>
<p>éœ€è¦ä¿è¯kernelçš„è®¾è®¡å®ç°äº†critical section</p>
<p>kernelçš„å®ç°åˆ†ä¸¤ç§ç±»å‹ï¼š</p>
<ul>
<li>æŠ¢å å¼å†…æ ¸ preemptive kernel</li>
<li>éæŠ¢å å¼å†…æ ¸ nonpreemptive kernel</li>
</ul>
<p>åŒºåˆ«æ˜¯æ˜¯å¦å…è®¸kernel modeè¢«æŠ¢å </p>
<p>æŠ¢å å¼å†…æ ¸æ›´éš¾è®¾è®¡ï¼Œä½†åŒæ—¶ä¹Ÿå“åº”æ›´å¿«ã€‚</p>
<h3 id="52-petersons-solution">5.2 Petersonâ€™s Solution</h3>
<p>çœæµï¼šè®©ä¸¤ä¸ªè¿›ç¨‹å…±äº«ä¸€ä¸ªå˜é‡ï¼Œæ—¢æœ‰turnï¼ˆè½®åˆ°è°èƒ½è¿›å»ï¼‰ä¹Ÿæœ‰flagï¼ˆè¿›ç¨‹æ˜¯å¦readyï¼‰ã€‚å½“flag[æŸä¸ªè¿›ç¨‹]ä¸”turn=è¯¥è¿›ç¨‹ï¼Œå°±å¯ä»¥è¿›å»ã€‚</p>
<aside>
ğŸ’¡ æƒ³è¦ç†è§£PSç®—æ³•ï¼Œè¯·æƒ³è±¡ä¸¤ä¸ªäººäº’ç›¸è®©åº§ï¼ŒAå…ˆè¯´ä½ åå§ï¼ŒBå†è¯´ä½ åå§ï¼Œè¿™æ—¶Aåä¸‹ã€‚

Aè·å¾—æ¤…å­æœ‰ä¸¤ä¸ªå……è¦æ¡ä»¶ï¼š

Aæƒ³å: flag[A] = 1

åœ¨Bè®©åº§ä¹‹å‰ï¼ŒAå·²ç»è®©è¿‡åº§äº†: turn â‰  A è¯´æ˜ä¹‹å‰turnæ›¾ç»è¢«èµ‹ä¸ºAï¼Œç°åœ¨æ˜¯B

</aside>

<div class="language-c highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="kt">int</span><span class="w"> </span><span class="n">turn</span><span class="p">;</span><span class="w">         </span><span class="c1">// who is allowed to enter</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a><span class="n">boolean</span><span class="w"> </span><span class="n">flag</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span><span class="w">  </span><span class="c1">// ready to enter its CS</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#__codelineno-2-4"></a><span class="kt">void</span><span class="w"> </span><span class="nf">foo</span><span class="p">(){</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#__codelineno-2-5"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">){</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#__codelineno-2-6"></a><span class="w">        </span><span class="n">flag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span><span class="w"> </span><span class="c1">// mark self ready</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#__codelineno-2-7"></a><span class="w">        </span><span class="n">turn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">-</span><span class="n">i</span><span class="p">;</span><span class="w">     </span><span class="c1">// assert that if the other process wishes to enter its CS, it can do so;</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#__codelineno-2-8"></a><span class="w">        </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="n">turn</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="o">-</span><span class="n">i</span><span class="p">);</span><span class="w"> </span><span class="c1">// wait</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#__codelineno-2-9"></a><span class="w">        </span><span class="cm">/* critical section */</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#__codelineno-2-10"></a><span class="w">        </span><span class="n">flag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span><span class="w">  </span><span class="c1">// set ready to false</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#__codelineno-2-11"></a><span class="w">        </span><span class="cm">/* reminder section */</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#__codelineno-2-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#__codelineno-2-13"></a><span class="p">}</span>
</span></code></pre></div>
<p>å…¶ä¸­ <code>i</code> æ˜¯0æˆ–1ï¼Œè¡¨ç¤ºç¬¬iä¸ªè¿›ç¨‹ã€‚ <code>turn</code> æ˜¯å½“å‰æœ‰æƒè¿›å…¥critical sectionçš„è¿›ç¨‹ï¼ˆ0æˆ–1ï¼‰; <code>flag</code> æ˜¯ç¬¬iä¸ªè¿›ç¨‹æ˜¯å¦å‡†å¤‡å¥½è¿›å…¥critical sectionï¼Œåˆå§‹å€¼å‡ä¸ºFALSEã€‚</p>
<p>To enter the critical section, process Pi first sets <code>flag[i]</code> to be true and then sets <code>turn</code> to the value <code>1-i</code> (the other process), thereby asserting that is the other process wishes to enter the critical section, it can do so. If both processes try to enter at the same time, <code>turn</code> will be set to both <code>0</code> and <code>1</code> at roughly the same time. Only one of these assignments will last; the other will occur but will be overwritten immediately. The eventual value of <code>turn</code> determines which of the two processes is allowed to enter its critical section first.</p>
<p>Petersonâ€™s Solutionæ»¡è¶³åŒæ­¥ç®—æ³•å¿…é¡»æ»¡è¶³çš„ä¸‰ä¸ªæ€§è´¨ï¼š</p>
<ul>
<li>Mutual exclusion äº’æ–¥<ul>
<li>ç”¨äº†ä¸€ä¸ªä¾‹å­è¯´ä¸å¯èƒ½æœ‰ä¸¤ä¸ªè¿›ç¨‹åŒæ—¶è¿›å…¥Critical Section</li>
</ul>
</li>
<li>Progress Requirement ç©ºé—²è®©è¿›<ul>
<li>å¦‚æœæ²¡æœ‰è¿›ç¨‹åœ¨CSï¼Œè€Œæœ‰ä¸€äº›è¿›ç¨‹åœ¨Enter sectionï¼Œä¸èƒ½è®©æƒ³è¦è¿›å…¥CSçš„è¿›ç¨‹æ— é™ç­‰å¾…</li>
<li>ç»è¿‡æœ‰é™æ¬¡ç­‰å¾…ä»¥åï¼Œéœ€è¦è¿›å…¥ï¼Œé¿å…Starvation</li>
</ul>
</li>
<li>Bounded Waiting è®©æƒç­‰å¾…<ul>
<li>æ˜¯å¦èƒ½è¿›å…¥critical sectionéœ€è¦å…¶å®ƒè¿›ç¨‹æ¥å†³å®š</li>
</ul>
</li>
</ul>
<p>Bakery Algorithmï¼š</p>
<blockquote>
<p>2ä¸ªè¿›ç¨‹ç‰ˆæœ¬çš„PSã€‚éœ€è¦éå†æ‰€æœ‰è¿›ç¨‹æŸ¥çœ‹å¤§å®¶çš„turn
</p>
</blockquote>
<p>Reordering é‡æ’åº</p>
<p>PSçš„ç¼ºç‚¹æ˜¯åœ¨ç°ä»£è®¡ç®—æœºä½“ç³»ç»“æ„ä¸Šä¸ä¸€å®šé€‚ç”¨ã€‚å› ä¸ºç°ä»£çš„å¤„ç†å™¨å’Œç¼–è¯‘å™¨å¯èƒ½ä¼šä¸ºäº†ä¼˜åŒ–æ€§èƒ½è€Œå¯¹ä¸€äº›è¯»å†™æ“ä½œè¿›è¡Œé‡æ’ã€‚</p>
<p>é‡æ’çš„æ—¶å€™ä¼šè€ƒè™‘é‡æ’åœ¨å•çº¿ç¨‹ç¨‹åºä¸­çš„åˆç†æ€§ï¼ˆè®¡ç®—ç»“æœæ˜¯ç¨³å®šä¸”æ­£ç¡®çš„ï¼‰ã€‚ä½†æ˜¯è¿™æ ·ä¸èƒ½ä¿è¯åœ¨å¤šçº¿ç¨‹å…±ç”¨æ•°æ®æ—¶çš„æ­£ç¡®æ€§ï¼Œå¯èƒ½åœ¨å¤šçº¿ç¨‹å…±ç”¨æ—¶å‡ºç°ä¸ç¡®å®šæˆ–ä¸å¯¹çš„è¾“å‡ºã€‚</p>
<p>e.g. ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯èƒ½ä¼šå¯¹æ•°æ®è¯»å–é¡ºåºè¿›è¡Œreorderï¼Œä»¥ä½¿ä¸éœ€è¦äº¤æ›¿è¯»å–ä¸¤ä¸ªæ•°æ®çš„å€¼ï¼Œè€Œæ˜¯ç›¸åŒè¯»å–æ”¾åœ¨ä¸€èµ·ã€‚</p>
<p>ä¸ºäº†è§£å†³é‡æ’åºå¯¼è‡´çš„åœ¨å¤šçº¿ç¨‹ä¸‹ä¸ç¨³å®šï¼Œæˆ‘ä»¬å¼•å…¥ï¼š</p>
<p>Memory Barrier</p>
<p>å®ƒç”¨æ¥ä¿è¯å…¶ä¹‹å‰çš„å†…å­˜è®¿é—®å…ˆäºä¹‹åçš„å®Œæˆã€‚å³ï¼Œåœ¨æŸä¸ªæ“ä½œå‰ï¼Œå†…å­˜çš„æ”¹å˜å¯¹å…¶å®ƒå¤„ç†å™¨ä¸Šçš„è¿›ç¨‹éƒ½æ˜¯å¯è§çš„ã€‚</p>
<p>åŠ memory barrierçš„ä¸€ç§æ–¹æ³•</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">flag</span><span class="p">)</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w">    </span><span class="n">memory_barrier</span><span class="p">();</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="n">print</span><span class="w"> </span><span class="n">x</span><span class="p">;</span>
</span></code></pre></div>
<p>è¿™æ ·å°±ä¿è¯äº†flagåœ¨xä¹‹å‰è¢«åŠ è½½äº†ã€‚</p>
<p>Memory Model</p>
<p>å¦å¤–ï¼Œåœ¨ç°ä»£çš„ä½“ç³»ç»“æ„ä¸Šï¼Œä¸€ä¸ªçº¿ç¨‹å†™äº†å¯¹åº”çš„å˜é‡åå¯èƒ½ä¸ä¼šç«‹å³å†™å›å†…å­˜ï¼Œè¿™ä¹Ÿæœ‰å¯èƒ½å¯¼è‡´é—®é¢˜ã€‚</p>
<p>è®¡ç®—æœºä½“ç³»ç»“æ„å†³å®šå“ªå—å†…å­˜ç»™å“ªä¸ªç¨‹åºçš„æ–¹æ³•ï¼Œå«åšmemory modelã€‚memory modelæœ‰ä¸¤ç§ç±»å‹</p>
<ul>
<li>Strongly ordered: a memory modification on one processor is immediately visible to all other processors.</li>
<li>Weakly ordered: modification to other memory on one processor may not be immediately visible to other processors.</li>
</ul>
<h3 id="53">5.3 ç¡¬ä»¶æŒ‡ä»¤</h3>
<p>æœ‰ä¸¤ä¸ªç¡¬ä»¶æŒ‡ä»¤èƒ½å¸®åŠ©å®ç°äº’æ–¥å’ŒåŒæ­¥</p>
<p>è®¸å¤šç°ä»£ç³»ç»Ÿæä¾›ç¡¬ä»¶æŒ‡ä»¤æ¥ä¿®æ”¹wordçš„å†…å®¹ï¼Œæˆ–è€…ç”¨äºatomically (uniterruptablyï¼Œä¸å¯è¢«æ‰“æ–­åœ°)äº¤æ¢ä¸¤ä¸ªwordã€‚</p>
<p>ç”¨æˆ·ä¸€èˆ¬ä¸ç”¨å…³å¿ƒç‰¹å®šæœºå™¨æŒ‡ä»¤ï¼Œå¯ä»¥ç”¨æŒ‡ä»¤ <code>test_and_set()</code> å’Œ <code>compare_and_swap()</code> æŠ½è±¡äº†è§£è¿™äº›æœºå™¨æŒ‡ä»¤èƒŒåçš„å«ä¹‰ã€‚</p>
<p><code>test_and_set</code> çš„å®šä¹‰æ˜¯æŠŠä¸€ä¸ªtrueè¾“å…¥åˆ°ç¡¬ä»¶ï¼Œå¹¶ä¸”æŠŠå˜é‡åŸæ¥çš„å€¼è¿”å›ã€‚å®ƒæ˜¯ä¸€ä¸ªåŸºæœ¬æŒ‡ä»¤å™¨ä»¶ã€‚</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="kt">bool</span><span class="w"> </span><span class="nf">test_and_set</span><span class="p">(</span><span class="kt">bool</span><span class="w"> </span><span class="o">*</span><span class="n">target</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="w">    </span><span class="kt">bool</span><span class="w"> </span><span class="n">rv</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">target</span><span class="p">;</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="w">    </span><span class="o">*</span><span class="n">target</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">rv</span><span class="p">;</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="p">}</span>
</span></code></pre></div>
<p>å®ƒçš„é‡è¦ç‰¹å¾æ˜¯ï¼Œå®ƒçš„æ‰§è¡Œæ˜¯atomicçš„ã€‚</p>
<p>è¿™ä¸ªæŒ‡ä»¤å¯ä»¥ç”¨æ¥å®ç°mutual exclusive: å®šä¹‰ä¸€ä¸ªboolå˜é‡ <code>lock</code>ï¼Œåˆå§‹åŒ–ä¸ºfalseã€‚</p>
<p>ä¸ºä»€ä¹ˆå¯ä»¥ï¼šå¦‚æœÂ <code>lock</code>Â åœ¨ Entry Section æ—¶ä¸º trueï¼Œé‚£ä¹ˆÂ <code>test_and_set(&amp;lock)</code>Â å°†è¿”å› trueï¼Œå› æ­¤ä¼šå§‹ç»ˆåœ¨ while å¾ªç¯ä¸­è¯¢é—®ã€‚ç›´åˆ°æŸä¸ªæ—¶åˆ»Â <code>lock</code>Â ä¸º falseï¼Œé‚£ä¹ˆÂ <code>test_and_set(&amp;lock)</code>Â å°†è¿”å› false åŒæ—¶å°†Â <code>lock</code>Â ç½®ä¸º trueï¼Œè¿›ç¨‹è¿›å…¥ Critical Sectionï¼ŒåŒæ—¶ä¿è¯å…¶ä»–è¿›ç¨‹æ— æ³•è¿›å…¥ Critical Sectionã€‚å½“æŒé”çš„è¿›ç¨‹å®Œæˆ Critical Section çš„è¿è¡Œï¼Œå®ƒåœ¨ Exit Section ä¸­é‡Šæ”¾Â <code>lock</code>Â ï¼Œä»è€Œå…è®¸å…¶ä»–è¿›ç¨‹è¿›å…¥ Critical Sectionã€‚è€Œå¦‚æœæŸä¸ªæ—¶åˆ»Â <code>lock</code>Â ä¸º falseï¼Œè€Œæœ‰ä¸¤ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹å‡ ä¹åŒæ—¶è°ƒç”¨äº†Â <code>test_and_set(&amp;lock)</code>Â ã€‚ä½†ç”±äºå®ƒæ˜¯ atomicï¼ˆnone-or-allï¼‰çš„ï¼Œå› æ­¤åªæœ‰ä¸€ä¸ªè¿›ç¨‹å¯ä»¥è¿”å› falseã€‚</p>
<p>ä¸èƒ½å®ç°bounded waitingæ€ä¹ˆåŠï¼Œæœ‰çš„è¿›ç¨‹å¯èƒ½å°±ä¸€ç›´æ²¡æœ‰æ‹¿åˆ°é”ï¼šåŠ ä¸€ä¸ªå¾ªç¯éå†æ‰¾ä¸‹ä¸€ä¸ªå¯ä»¥è¿›å…¥çš„è¿›ç¨‹ï¼Œæ¯ä¸ªè¿›ç¨‹æœ€å¤šç­‰å…¨éƒ¨éå†å®Œä¸€éå°±è½®åˆ°è‡ªå·±</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">){</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#__codelineno-5-2"></a><span class="w">    </span><span class="cm">/* Entry Section */</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#__codelineno-5-3"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">test_and_set</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="p">))</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#__codelineno-5-4"></a><span class="w">        </span><span class="p">;</span><span class="w"> </span><span class="cm">/* do something */</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#__codelineno-5-5"></a><span class="w">    </span><span class="cm">/* Critical Section */</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#__codelineno-5-6"></a>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#__codelineno-5-7"></a><span class="w">    </span><span class="cm">/* Exit Section */</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#__codelineno-5-8"></a><span class="w">    </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#__codelineno-5-9"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">((</span><span class="n">j</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">i</span><span class="p">)</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span><span class="o">!</span><span class="n">waiting</span><span class="p">[</span><span class="n">j</span><span class="p">]))</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#__codelineno-5-10"></a><span class="w">        </span><span class="n">j</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">%</span><span class="w"> </span><span class="n">n</span><span class="p">;</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#__codelineno-5-11"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">j</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">i</span><span class="p">)</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#__codelineno-5-12"></a><span class="w">        </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#__codelineno-5-13"></a><span class="w">    </span><span class="k">else</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#__codelineno-5-14"></a><span class="w">        </span><span class="n">waiting</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#__codelineno-5-15"></a>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#__codelineno-5-16"></a><span class="w">    </span><span class="cm">/* Remainder Section */</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#__codelineno-5-17"></a>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#__codelineno-5-18"></a><span class="p">}</span>
</span></code></pre></div>
<p><code>compare_and_swap()</code> ç”¨è½¯ä»¶æ¥å®ç°æ€§èƒ½éå¸¸å·®ï¼Œç”¨è½¯ä»¶æ¥å®ç°ä¼šå˜å¥½ã€‚å®ƒçš„å®šä¹‰æ˜¯</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a><span class="kt">int</span><span class="w"> </span><span class="nf">compare_and_swap</span><span class="p">(</span><span class="kt">int</span><span class="w"> </span><span class="o">*</span><span class="n">value</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">expected</span><span class="p">,</span><span class="w"> </span><span class="kt">int</span><span class="w"> </span><span class="n">new_value</span><span class="p">){</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">value</span><span class="p">;</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="o">*</span><span class="n">value</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="n">expected</span><span class="p">)</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">        </span><span class="o">*</span><span class="n">value</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">new_value</span><span class="p">;</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">    </span><span class="k">return</span><span class="w"> </span><span class="n">temp</span><span class="p">;</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="p">}</span>
</span></code></pre></div>
<p>å¯è§å…¶å®<code>compare_and_swap()</code> ä¸<code>test_and_set()</code> ä½œç”¨ç±»ä¼¼ã€‚</p>
<p>ç”¨<code>compare_and_swap()</code> å®ç°mutual exclusive</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="w">    </span><span class="cm">/* Entry Section */</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">compare_and_swap</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lock</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="w">        </span><span class="p">;</span><span class="w"> </span><span class="cm">/* do nothing */</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="w">    </span><span class="cm">/* Critical Section */</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a><span class="w">    </span><span class="cm">/* Exit Section */</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#__codelineno-7-9"></a><span class="w">    </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#__codelineno-7-10"></a>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#__codelineno-7-11"></a><span class="w">    </span><span class="cm">/* Remainder Section */</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#__codelineno-7-12"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="54-semaphores">5.4 ä¿¡å·é‡ Semaphores</h3>
<p>æ˜¯ä¸€ä¸ªæ•´å‹å˜é‡ï¼Œé™¤äº†åˆå§‹åŒ–å¤–ï¼Œåªèƒ½é€šè¿‡ä¸¤ä¸ªatomicæ“ä½œ <code>wait()</code> å’Œ <code>signal()</code> æ¥è®¿é—®ã€‚</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">wait</span><span class="p">(</span><span class="n">S</span><span class="p">){</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">S</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a><span class="w">        </span><span class="p">;</span><span class="w"> </span><span class="cm">/* busy waiting */</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a><span class="w">    </span><span class="n">S</span><span class="o">--</span><span class="p">;</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a><span class="p">}</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="kt">void</span><span class="w"> </span><span class="nf">signal</span><span class="p">(</span><span class="n">S</span><span class="p">){</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">    </span><span class="n">S</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="p">}</span>
</span></code></pre></div>
<p>æœ‰ä¸¤ç§semaphoreï¼š</p>
<ul>
<li>counting semaphoreï¼šSçš„å€¼ä¸å—é™åˆ¶</li>
<li>binary semaphore: Sçš„å€¼åªèƒ½æ˜¯0æˆ–1ï¼Œç±»ä¼¼ä¸äº’æ–¥é”ã€‚</li>
</ul>
<p>e.g. Consider P1 and P2 that require S1 to happen before S2, create a semaphore â€œsynchâ€ initialized to 0.</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nl">P1</span><span class="p">:</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="w">    </span><span class="n">S1</span><span class="p">;</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="w">    </span><span class="n">signal</span><span class="p">(</span><span class="n">synch</span><span class="p">);</span>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="nl">P2</span><span class="p">:</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="w">    </span><span class="n">wait</span><span class="p">(</span><span class="n">synch</span><span class="p">);</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="w">    </span><span class="n">S2</span><span class="p">;</span>
</span></code></pre></div>
<p>å¦‚æœæƒ³è¦è§£å†³semaphoreçš„busy waitingé—®é¢˜ï¼Œå¯ä»¥å¼•å…¥waiting queue</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a><span class="k">typedef</span><span class="w"> </span><span class="k">struct</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">value</span><span class="p">;</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a><span class="w">    </span><span class="k">struct</span><span class="w"> </span><span class="nc">list_head</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="n">waiting_queue</span><span class="p">;</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a><span class="p">}</span><span class="w"> </span><span class="n">semaphore</span><span class="p">;</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="n">wait</span><span class="p">(</span><span class="n">semaphore</span><span class="w"> </span><span class="o">*</span><span class="n">S</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">    </span><span class="n">S</span><span class="o">-&gt;</span><span class="n">value</span><span class="o">--</span><span class="p">;</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">S</span><span class="o">-&gt;</span><span class="n">value</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">        </span><span class="n">add</span><span class="w"> </span><span class="n">this</span><span class="w"> </span><span class="n">process</span><span class="w"> </span><span class="n">to</span><span class="w"> </span><span class="n">S</span><span class="o">-&gt;</span><span class="n">list</span><span class="p">;</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">        </span><span class="n">block</span><span class="p">();</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="p">}</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a><span class="n">signal</span><span class="p">(</span><span class="n">semaphore</span><span class="w"> </span><span class="o">*</span><span class="n">S</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="w">    </span><span class="n">S</span><span class="o">-&gt;</span><span class="n">value</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">S</span><span class="o">-&gt;</span><span class="n">value</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="w">        </span><span class="n">remove</span><span class="w"> </span><span class="n">a</span><span class="w"> </span><span class="n">process</span><span class="w"> </span><span class="n">P</span><span class="w"> </span><span class="n">from</span><span class="w"> </span><span class="n">S</span><span class="o">-&gt;</span><span class="n">list</span><span class="p">;</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="w">        </span><span class="n">wakeup</span><span class="p">(</span><span class="n">P</span><span class="p">);</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a><span class="p">}</span>
</span></code></pre></div>
<p>å¯èƒ½ä¼šå¯¼è‡´deadlock</p>
<h3 id="55-atomic-variable">5.5 Atomic Variable</h3>
<p>é‚£å°±ç›´æ¥ç”¨<code>compare_and_swap()</code> æ¥åšæˆä¸€äº›atomicçš„æœºå™¨æŒ‡ä»¤å·¥å…·</p>
<p>e.g. count++ æ˜¯å¯ä»¥æ‰“æ–­çš„ï¼Œä½†æ˜¯å¯ä»¥è®¾è®¡ä¸€ä¸ªä¸å¯æ‰“æ–­çš„increment(&amp;count)</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">increment</span><span class="p">(</span><span class="kt">atomic_int</span><span class="w"> </span><span class="o">*</span><span class="n">v</span><span class="p">){</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="w">    </span><span class="kt">int</span><span class="w"> </span><span class="n">temp</span><span class="p">;</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="w">    </span><span class="k">do</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="w">        </span><span class="n">temp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="o">*</span><span class="n">v</span><span class="p">;</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a><span class="w">    </span><span class="p">}</span><span class="w"> </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">temp</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="n">compare_and_swap</span><span class="p">(</span><span class="n">v</span><span class="p">,</span><span class="w"> </span><span class="n">temp</span><span class="p">,</span><span class="w"> </span><span class="n">temp</span><span class="o">+</span><span class="mi">1</span><span class="p">));</span><span class="w">  </span><span class="c1">// å®ƒä¸ä¼šè¢«æ‰“æ–­</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a><span class="p">}</span>
</span></code></pre></div>
<p>è¦è®°å¾—å®ƒåªèƒ½è§£å†³å˜é‡æ›´æ–°è¿‡ç¨‹ä¸­çš„race conditionã€‚æ­¤æ—¶åªæœ‰å¾…æ›´æ–°å˜é‡ä¸€ä¸ªå˜é‡åœ¨ç­‰å¾…è¯»å–ã€‚å¦‚æœæœ‰ä¸¤ä¸ªconsumerç­‰å¾…è¯»å–ï¼Œä½†countæ”¹å˜æ—¶åªä¼šäº§ç”Ÿä¸€ä¸ªå€¼åœ¨bufferé‡Œï¼Œé‚£å°±ä¸è¡Œã€‚</p>
<h3 id="56-mutex-mutual-exclusion-lock">5.6 Mutex (Mutual Exclusion Lock)</h3>
<p>ç”¨è½¯ä»¶æ–¹æ³•è§£å†³CSã€‚</p>
<p>è®©è¿›ç¨‹å…ˆåœ¨entry sectionç”³è¯·acquire()ä¸€ä¸ªé”ï¼Œç„¶ååœ¨exit section release()ä¸€ä¸ªé”ã€‚ç„¶åç”¨ä¸€ä¸ªboolå˜é‡æ¥çœ‹å®ƒæ˜¯å¦available</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">){</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a><span class="w">    </span><span class="n">acquire</span><span class="p">();</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a><span class="w">    </span><span class="cm">/* critical section */</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a><span class="w">    </span><span class="n">release</span><span class="p">();</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">    </span><span class="cm">/* remainder section */</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="p">}</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="kt">void</span><span class="w"> </span><span class="n">acquire</span><span class="p">(){</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="o">!</span><span class="n">available</span><span class="p">)</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="w">    </span><span class="p">;</span><span class="w"> </span><span class="cm">/* busy waiting */</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w">    </span><span class="n">available</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">false</span><span class="p">;</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="p">}</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="kt">void</span><span class="w"> </span><span class="n">release</span><span class="p">(){</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="w">    </span><span class="n">availble</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="p">}</span>
</span></code></pre></div>
<p>å› ä¸ºè¿˜éœ€è¦ä¿è¯äº’æ–¥ï¼Œéœ€è¦ä¿è¯acquireæ˜¯åŸå­æ€§çš„ï¼Œé‚£å°±ç”¨ä¸Šè¿°ä¸¤ä¸ªç¡¬ä»¶å·¥å…·æ¥å®ç°ã€‚ä»£ç åŒå¯¹åº”èŠ‚ï¼Œä¸èµ˜è¿°ã€‚</p>
<p>ç¼ºç‚¹ï¼šéœ€è¦busy waitingï¼Œå½“æœ‰ä¸€ä¸ªè¿›ç¨‹åœ¨CSä¸­æ—¶ï¼Œå…¶å®ƒè¿›ç¨‹éœ€è¦åœ¨acquire()ä¸­spinï¼Œæ‰€ä»¥ä¹Ÿç§°ä¸ºspinlockã€‚å¦‚æœæœ‰Nä¸ªè¿›ç¨‹åŒæ—¶ä½¿ç”¨ä¸€ä¸ªCPUï¼Œé‚£ä¹ˆå°†å¤§çº¦æœ‰(N-1)/Nçš„æµªè´¹ã€‚å¦‚æœæœ‰è¿›ç¨‹åœ¨ä¼å›¾acquireä¸€ä¸ªé”æ—¶è¢«ç»„ç»‡ï¼Œç§°å®ƒä¸ºcontendedï¼ˆè¢«äº‰å¤ºï¼‰ï¼›åä¹‹ç§°ä¸ºuncontendedã€‚</p>
<p>è¿˜å¯ä»¥è€ƒè™‘ä¸‹é¢çš„è®¾è®¡ï¼Œå…¶ä¸­yield()ä¼šä½¿ç¨‹åºä»runningè½¬ä¸ºreadyï¼Œä»è€Œè®©å‡ºCPU</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#__codelineno-13-1"></a><span class="kt">void</span><span class="w"> </span><span class="nf">acquire</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#__codelineno-13-2"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="n">compare_and_swap</span><span class="p">(</span><span class="o">&amp;</span><span class="n">avaliable</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="o">!=</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#__codelineno-13-3"></a><span class="w">        </span><span class="n">yield</span><span class="p">();</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#__codelineno-13-4"></a><span class="p">}</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#__codelineno-13-5"></a>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#__codelineno-13-6"></a><span class="kt">void</span><span class="w"> </span><span class="nf">release</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#__codelineno-13-7"></a><span class="w">    </span><span class="n">avaliable</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nb">true</span><span class="p">;</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#__codelineno-13-8"></a><span class="p">}</span>
</span></code></pre></div>
<p>ï¼ˆè¿™ä¸ªåœ°æ–¹çœŸçš„çœŸçš„æ²¡çœ‹æ‡‚ï¼‰</p>
<h3 id="57-priority-inversion">5.7 Priority Inversion</h3>
<p>e.g.</p>
<p>Three processes PL, PM and PN with priority PL &lt; PM &lt; PH.</p>
<p>PL holds a lock that was requested by PH â†’ PH is blocked.</p>
<p>PM becomes ready and preempted the PL</p>
<p>It effectively inverts the relative priorities of PM and PH.</p>
<p>å…·æœ‰ä¸­ç­‰ä¼˜å…ˆçº§çš„PMå½±å“äº†é«˜ä¼˜å…ˆçº§çš„PHçš„ç­‰å¾…æ—¶é—´ï¼Œè¿™æ ·æ˜¯ä¸å¯¹çš„ã€‚</p>
<p>è§£å†³æ–¹æ¡ˆï¼š</p>
<p>å¯ä»¥é€šè¿‡ä¼˜å…ˆçº§ç»§æ‰¿priority inheritanceæ¥è§£å†³ã€‚æ‰€æœ‰æ­£åœ¨è®¿é—®èµ„æºçš„è¿›ç¨‹ï¼ˆå¦‚PLï¼‰éœ€è¦è·å¾—è®¿é—®è¿™ä¸ªèµ„æºçš„æ›´é«˜ä¼˜å…ˆçº§çš„è¿›ç¨‹çš„ä¼˜å…ˆçº§ï¼ˆPHï¼‰ï¼Œç›´åˆ°å…¶ç”¨å®Œæœ‰å…³èµ„æºä¸ºæ­¢ã€‚æ¯”å¦‚ä¸Šä¾‹ä¸­ï¼ŒPLä¼šä¸´æ—¶ç»§æ‰¿PLçš„ä¼˜å…ˆçº§ï¼Œç„¶åPHè¿è¡Œï¼Œæœ€åPMè¿è¡Œã€‚</p>
<h2 id="6">6. ç»å…¸åŒæ­¥é—®é¢˜</h2>
<p>ä¸€èˆ¬æˆ‘ä»¬ç”¨ä¿¡å·é‡è§£å†³é—®é¢˜</p>
<p>ä¿¡å·é‡çš„é€»è¾‘ï¼šä¸€ä¸ªä¿¡å·é‡ç”¨æ¥è¡¨ç¤ºä¸€ç±»â€œèµ„æºâ€çš„ä½™é‡ã€‚wait()ç­‰å¾…åˆ°å…¶æœ‰ä½™é‡æ—¶ä»ä¸­å–èµ°ä¸€ä¸ªï¼Œè€Œsignal()é‡Šæ”¾ä¸€ä¸ªèµ„æºã€‚</p>
<p>ï¼ˆä¸Šè¾¹è¿™æ®µåœ¨å†™ä»€ä¹ˆï¼‰</p>
<h3 id="61-bounded-buffer-problem">6.1 Bounded-buffer Problem</h3>
<aside>
ğŸ’¡ ç»™å®šä¸¤ä¸ªè¿›ç¨‹ï¼šproducerå’Œconsumerï¼Œå…±ç”¨å¤§å°ä¸ºnçš„bufferã€‚producerç”Ÿäº§æ•°æ®æ”¾å…¥bufferï¼Œconsumerä»bufferä¸­å–å‡ºæ•°æ®å¹¶ä½¿ç”¨ä¹‹ã€‚

è¯¥é—®é¢˜éœ€è¦ä¿è¯ï¼šproducerä¸åº”å½“åœ¨bufferæ»¡æ—¶æ”¾å…¥æ•°æ®ï¼Œconsumerä¹Ÿä¸åº”å½“åœ¨bufferç©ºæ—¶å–å‡ºæ•°æ®ã€‚

</aside>

<p>é¦–å…ˆï¼Œæ ¹æ®æˆ‘ä»¬åœ¨å‰ä¸€èŠ‚ä¸­çš„è®¨è®ºï¼Œproduceå’Œconsumeçš„è¿‡ç¨‹ä¼šè®¿é—®åˆ°bufferçš„èµ„æºï¼Œå› æ­¤è®¿é—®bufferæ˜¯critical sectionï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ä¸€ä¸ªé”ï¼ˆæˆ–è€…ä¿¡å·é‡ï¼‰æ¥æ§åˆ¶å¯¹bufferçš„è®¿é—®ã€‚</p>
<p>è®¨è®ºäº†ä¸€ä¸‹é”æ°¸è¿œä¸å¯èƒ½æœ‰æœ€ä¼˜è§£ï¼šæ²¡çœ‹æ‡‚</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#__codelineno-14-1"></a><span class="n">semaphore</span><span class="w"> </span><span class="n">lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#__codelineno-14-2"></a><span class="n">semaphore</span><span class="w"> </span><span class="n">eslot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">BUFFER_SIZE</span><span class="p">;</span><span class="w"> </span><span class="c1">// ç©ºé—²bufferçš„æ•°é‡</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#__codelineno-14-3"></a><span class="n">semaphore</span><span class="w"> </span><span class="n">fslot</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#__codelineno-14-4"></a>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#__codelineno-14-5"></a><span class="n">producer</span><span class="p">(){</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#__codelineno-14-6"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">){</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#__codelineno-14-7"></a><span class="w">        </span><span class="n">wait</span><span class="w"> </span><span class="p">(</span><span class="n">eslot</span><span class="p">);</span><span class="w"> </span><span class="c1">// if buffer is full. i.e. eslot == 0, wait. else eslot --</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#__codelineno-14-8"></a><span class="w">        </span><span class="n">wait</span><span class="w"> </span><span class="p">(</span><span class="n">lock</span><span class="p">);</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#__codelineno-14-9"></a><span class="w">        </span><span class="n">add_to_buffer</span><span class="p">(</span><span class="n">next_produced</span><span class="p">);</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#__codelineno-14-10"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">lock</span><span class="p">);</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#__codelineno-14-11"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">fslot</span><span class="p">);</span><span class="w"> </span><span class="c1">// fslot ++</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#__codelineno-14-12"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#__codelineno-14-13"></a><span class="p">}</span>
</span><span id="__span-14-14"><a id="__codelineno-14-14" name="__codelineno-14-14" href="#__codelineno-14-14"></a>
</span><span id="__span-14-15"><a id="__codelineno-14-15" name="__codelineno-14-15" href="#__codelineno-14-15"></a><span class="n">consumer</span><span class="p">(){</span>
</span><span id="__span-14-16"><a id="__codelineno-14-16" name="__codelineno-14-16" href="#__codelineno-14-16"></a><span class="w">    </span><span class="k">while</span><span class="p">(</span><span class="nb">true</span><span class="p">){</span>
</span><span id="__span-14-17"><a id="__codelineno-14-17" name="__codelineno-14-17" href="#__codelineno-14-17"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">fslot</span><span class="p">);</span><span class="w">  </span><span class="c1">// if buffer is empty. i.e. fslot == 0, wait. else fslot--</span>
</span><span id="__span-14-18"><a id="__codelineno-14-18" name="__codelineno-14-18" href="#__codelineno-14-18"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">lock</span><span class="p">);</span>
</span><span id="__span-14-19"><a id="__codelineno-14-19" name="__codelineno-14-19" href="#__codelineno-14-19"></a><span class="w">        </span><span class="n">next_consumed</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">take_from_buffer</span><span class="p">();</span>
</span><span id="__span-14-20"><a id="__codelineno-14-20" name="__codelineno-14-20" href="#__codelineno-14-20"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">lock</span><span class="p">);</span>
</span><span id="__span-14-21"><a id="__codelineno-14-21" name="__codelineno-14-21" href="#__codelineno-14-21"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">eslot</span><span class="p">);</span><span class="w"> </span><span class="c1">// eslot ++</span>
</span><span id="__span-14-22"><a id="__codelineno-14-22" name="__codelineno-14-22" href="#__codelineno-14-22"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-14-23"><a id="__codelineno-14-23" name="__codelineno-14-23" href="#__codelineno-14-23"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="62-reader-writer-problem">6.2 Reader-Writer Problem</h3>
<aside>
ğŸ’¡ å¯¹ä¸€ä¸ªæ•°æ®ï¼Œreadersè¯»ï¼Œwritersè¯»å’Œå†™

è®¾è®¡æ–¹æ¡ˆä¿è¯ï¼šå¤šä¸ªreaderså¯ä»¥åŒæ—¶è¯»å–ï¼Œä½†æ˜¯writerè¿›è¡Œè¯»å†™æ—¶ä¸èƒ½æœ‰å…¶å®ƒwriterså’Œreadersã€‚

</aside>

<div class="language-c highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#__codelineno-15-1"></a><span class="n">semaphore</span><span class="w"> </span><span class="n">write_lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#__codelineno-15-2"></a><span class="kt">int</span><span class="w"> </span><span class="n">reader_count</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">0</span><span class="p">;</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#__codelineno-15-3"></a><span class="n">semaphore</span><span class="w"> </span><span class="n">reader_count_lock</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#__codelineno-15-4"></a><span class="n">semaphore</span><span class="w"> </span><span class="n">writer_first</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#__codelineno-15-5"></a>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#__codelineno-15-6"></a><span class="n">writer</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#__codelineno-15-7"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#__codelineno-15-8"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">writer_first</span><span class="p">);</span>
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#__codelineno-15-9"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">write_lock</span><span class="p">);</span>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#__codelineno-15-10"></a><span class="w">        </span><span class="n">read_and_write</span><span class="p">();</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#__codelineno-15-11"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">write_lock</span><span class="p">);</span>
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#__codelineno-15-12"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">writer_first</span><span class="p">);</span>
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#__codelineno-15-13"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#__codelineno-15-14"></a><span class="p">}</span>
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#__codelineno-15-15"></a>
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#__codelineno-15-16"></a><span class="n">reader</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#__codelineno-15-17"></a><span class="w">    </span><span class="k">while</span><span class="w"> </span><span class="p">(</span><span class="nb">true</span><span class="p">)</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#__codelineno-15-18"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">writer_first</span><span class="p">);</span>
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#__codelineno-15-19"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">reader_count_lock</span><span class="p">);</span>
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#__codelineno-15-20"></a><span class="w">        </span><span class="n">reader_count</span><span class="o">++</span><span class="p">;</span>
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#__codelineno-15-21"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reader_count</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">)</span>
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#__codelineno-15-22"></a><span class="w">            </span><span class="n">wait</span><span class="p">(</span><span class="n">write_lock</span><span class="p">);</span>
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#__codelineno-15-23"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">reader_count_lock</span><span class="p">);</span>
</span><span id="__span-15-24"><a id="__codelineno-15-24" name="__codelineno-15-24" href="#__codelineno-15-24"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">writer_first</span><span class="p">);</span>
</span><span id="__span-15-25"><a id="__codelineno-15-25" name="__codelineno-15-25" href="#__codelineno-15-25"></a>
</span><span id="__span-15-26"><a id="__codelineno-15-26" name="__codelineno-15-26" href="#__codelineno-15-26"></a><span class="w">        </span><span class="n">read</span><span class="p">();</span>
</span><span id="__span-15-27"><a id="__codelineno-15-27" name="__codelineno-15-27" href="#__codelineno-15-27"></a>
</span><span id="__span-15-28"><a id="__codelineno-15-28" name="__codelineno-15-28" href="#__codelineno-15-28"></a><span class="w">        </span><span class="n">wait</span><span class="p">(</span><span class="n">reader_count_lock</span><span class="p">);</span>
</span><span id="__span-15-29"><a id="__codelineno-15-29" name="__codelineno-15-29" href="#__codelineno-15-29"></a><span class="w">        </span><span class="n">reader_count</span><span class="o">--</span><span class="p">;</span>
</span><span id="__span-15-30"><a id="__codelineno-15-30" name="__codelineno-15-30" href="#__codelineno-15-30"></a><span class="w">        </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">reader_count</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span>
</span><span id="__span-15-31"><a id="__codelineno-15-31" name="__codelineno-15-31" href="#__codelineno-15-31"></a><span class="w">            </span><span class="n">signal</span><span class="p">(</span><span class="n">write_lock</span><span class="p">);</span>
</span><span id="__span-15-32"><a id="__codelineno-15-32" name="__codelineno-15-32" href="#__codelineno-15-32"></a><span class="w">        </span><span class="n">signal</span><span class="p">(</span><span class="n">reader_count_lock</span><span class="p">);</span>
</span><span id="__span-15-33"><a id="__codelineno-15-33" name="__codelineno-15-33" href="#__codelineno-15-33"></a><span class="w">    </span><span class="p">}</span>
</span><span id="__span-15-34"><a id="__codelineno-15-34" name="__codelineno-15-34" href="#__codelineno-15-34"></a><span class="p">}</span>
</span></code></pre></div>
<h3 id="63-dining-philosophers-problem">6.3 Dining-Philosophers Problem</h3>
<aside>
ğŸ’¡ 5ä¸ªå“²å­¦å®¶ä¸€èµ·åƒé¥­ã€‚æ¯ä¸¤ä¸ªå“²å­¦å®¶ä¹‹é—´æœ‰ä¸€æ ¹ç­·å­ï¼Œæ¯ä¸ªäººä¸€æ¬¡å¯ä»¥æ‹¿èµ·ä¸€æ ¹ç­·å­ï¼Œæ‹¿åˆ°ä¸¤æ ¹ç­·å­çš„å°±å¯ä»¥åƒä¸€æ®µæ—¶é—´ï¼Œåƒå®Œæ€è€ƒä¸€æ®µæ—¶é—´ã€‚

![OS%20Lecture%20%E8%BF%9B%E7%A8%8B%E4%B8%8E%E5%90%8C%E6%AD%A5%208a4f18b7687b4834a9402d982a22680e/Untitled%2013.png](OS%20Lecture%20%E8%BF%9B%E7%A8%8B%E4%B8%8E%E5%90%8C%E6%AD%A5%208a4f18b7687b4834a9402d982a22680e/Untitled%2013.png)

</aside>

<p>ä¸‰ç§è§£å†³æ–¹æ¡ˆï¼š</p>
<ul>
<li>å¯ä»¥çš„è¯ï¼Œæ‰€æœ‰äººæ‹¿èµ·å·¦è¾¹çš„ç­·å­ â†’ æœ‰çš„æ—¶å€™å¯èƒ½æ¯ä¸ªäººåŒæ—¶æ‹¿èµ·å·¦è¾¹çš„ç­·å­ï¼Œå¯¼è‡´æ­»é”</li>
<li>åªå…è®¸åŒæ—¶æ‹¿èµ·ä¸¤æ ¹ç­·å­ï¼šè½®æµè¯¢é—®æ¯ä¸ªäººæ˜¯å¦èƒ½æ‹¿èµ·ä¸¤æ ¹ç­·å­ï¼Œå¦‚æœèƒ½åˆ™æ‹¿èµ·ï¼Œä¸èƒ½åˆ™ç­‰å¾…æ”¾ä¸‹</li>
<li>å¥‡æ•°äººå…ˆæ‹¿å·¦è¾¹ç­·å­ï¼Œå¶æ•°äººå…ˆæ‹¿å³è¾¹ç­·å­</li>
</ul>
<h2 id="7-deadlocks">7. æ­»é” Deadlocks</h2>
<p>æ˜¯æŒ‡å¤šä¸ªè¿›ç¨‹å› ç«äº‰èµ„æºå¯¼è‡´çš„ä¸€ç§åƒµå±€ï¼Œå³è‹¥å¹²è¿›ç¨‹å„æŒæœ‰ä¸€äº›èµ„æºï¼ŒåŒæ—¶ç­‰å¾…è·å–å¦ä¸€ä¸ªè¿›ç¨‹æŒæœ‰çš„èµ„æºï¼Œå½¢æˆçš„äº’ç›¸ç­‰å¾…å±€é¢ã€‚</p>
<p>e.g.</p>
<p>ä¸¤ä¸ªè¿›ç¨‹ï¼Œä¸¤ä¸ªç£ç›˜é©±åŠ¨å™¨</p>
<div class="language-c highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#__codelineno-16-1"></a><span class="n">semaphore</span><span class="w"> </span><span class="n">first_mutex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#__codelineno-16-2"></a><span class="n">semaphore</span><span class="w"> </span><span class="n">second_mutex</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">;</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#__codelineno-16-3"></a>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#__codelineno-16-4"></a><span class="n">thread_one</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#__codelineno-16-5"></a><span class="w">    </span><span class="n">wait</span><span class="p">(</span><span class="n">first_mutex</span><span class="p">);</span><span class="w">  </span><span class="c1">// æŒæœ‰ä¸€ä¸ª</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#__codelineno-16-6"></a><span class="w">    </span><span class="n">wait</span><span class="p">(</span><span class="n">second_mutex</span><span class="p">);</span><span class="w"> </span><span class="c1">// æƒ³è¦å¦ä¸€ä¸ª</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#__codelineno-16-7"></a><span class="w">    </span><span class="c1">// ...</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#__codelineno-16-8"></a><span class="p">}</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#__codelineno-16-9"></a>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#__codelineno-16-10"></a><span class="n">thread_two</span><span class="p">()</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#__codelineno-16-11"></a><span class="w">    </span><span class="n">wait</span><span class="p">(</span><span class="n">second_mutex</span><span class="p">);</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#__codelineno-16-12"></a><span class="w">    </span><span class="n">wait</span><span class="p">(</span><span class="n">first_mutex</span><span class="p">);</span>
</span><span id="__span-16-13"><a id="__codelineno-16-13" name="__codelineno-16-13" href="#__codelineno-16-13"></a><span class="w">    </span><span class="c1">// ...</span>
</span><span id="__span-16-14"><a id="__codelineno-16-14" name="__codelineno-16-14" href="#__codelineno-16-14"></a><span class="p">}</span>
</span></code></pre></div>
<p>å¯ä»¥é€šè¿‡åˆ†é…ä¼˜å…ˆçº§æ¥è§£å†³ï¼Œä½†æ˜¯ä¼˜å…ˆçº§å¯èƒ½å¯¼è‡´starvation</p>
<h3 id="71-system-resource-allocation-graph">7.1 èµ„æºåˆ†é…å›¾ system resource-allocation graph</h3>
<p>æ˜¯ä¸€ç§å¯¹ç³»ç»Ÿèµ„æºå’Œæƒ³ä½¿ç”¨èµ„æºçš„å®ä¾‹è¿›è¡Œå»ºæ¨¡çš„è§„èŒƒåŒ–ä½œå›¾æ ‡å‡†</p>
<p>å‡è®¾æœ‰mä¸ªèµ„æº(resources) R1â€¦ Rmï¼Œæ¯ç§èµ„æºæœ‰Wä¸ªå®ä¾‹ï¼ˆinstanceï¼‰ã€‚å„ä¸ªæ´»åŠ¨è¿›ç¨‹P1â€¦Pnä¼šåˆ©ç”¨è¿™äº›èµ„æºï¼Œæ¯ä¸ªèµ„æºçš„åˆ©ç”¨ç”±request, use, releaseä¸‰æ­¥ç»„æˆã€‚
<img alt="" src="../asset/OS214.png" />
èµ„æºåˆ†é…å›¾æ˜¯ä¸€ç§æœ‰å‘å›¾</p>
<ul>
<li>ç‚¹é›† V = P \and R<ul>
<li>æ´»åŠ¨è¿›ç¨‹é›†åˆ P = {P1, â€¦ Pn} ç”¨åœ†è¡¨ç¤º</li>
<li>èµ„æºç±»å‹é›†åˆ R = {R1, â€¦ Rn} ç”¨çŸ©å½¢è¡¨ç¤ºï¼Œé‡Œé¢ç”¨åœ†ç‚¹ä¸ªæ•°è¡¨ç¤ºå„ä¸ªèµ„æºå®ä¾‹</li>
</ul>
</li>
<li>è¾¹é›†<ul>
<li>ç”³è¯·è¾¹ request edge P â†’ R è¡¨ç¤ºè¿›ç¨‹å·²ç”³è¯·å¹¶åœ¨ç­‰å¾…èµ„æºã€‚åœ†æŒ‡å‘çŸ©å½¢</li>
<li>åˆ†é…è¾¹ assignment edge R â†’ P è¡¨ç¤ºèµ„æºå·²ç»åˆ†é…ç»™äº†è¿›ç¨‹ã€‚çŸ©å½¢é‡Œçš„åœ†ç‚¹æŒ‡å‘åœ†</li>
</ul>
</li>
</ul>
<p>æ²¡æœ‰ç¯ä¸€å®šæ²¡æœ‰æ­»é”ï¼Œæœ‰ç¯å¯èƒ½ä½†ä¸ä¸€å®šæœ‰æ­»é”ï¼Œæœ‰ç¯ä¸”æ¯ä¸ªèµ„æºåªæœ‰ä¸€ä¸ªå®ä¾‹ä¸€å®šæœ‰æ­»é”ã€‚</p>
<h3 id="72">7.2 æ­»é”çš„å¿…è¦æ¡ä»¶</h3>
<aside>
ğŸ’¡ æƒ³è¦ç†è§£è¿™ä¸€å—ï¼Œè¯·æƒ³è±¡å››ä¸ªæˆç¯çš„å…¬äº¤è·¯å£ï¼Œæ¯ä¸ªå…¬äº¤è·¯å£éƒ½å µç€ä¸€æ’æƒ³è¦é¡ºæ—¶é’ˆå‰è¡Œçš„è½¦ã€‚æ¯ä¸ªè½¦éƒ½æƒ³è¿›å…¥ä¸‹ä¸€ä¸ªè·¯å£ï¼Œä½†æ˜¯æ¯ä¸ªè·¯å£éƒ½è¢«ä¸Šä¸€è¾†è½¦å µç€

</aside>

<p>ä¸‹é¢å››ç‚¹çš„äº¤</p>
<p>å¿…è¦æ¡ä»¶â†’æ‰“ç ´ä»»æ„ä¸€ç‚¹å°±èƒ½é¿å…æ­»é”</p>
<ul>
<li>Mutual exclusionï¼šè‡³å°‘ä¸€ä¸ªèµ„æºå¤„äºéå…±äº«æ¨¡å¼ï¼ˆå³æ¯ä¸ªèµ„æºåªæœ‰ä¸€ä¸ªå®ä¾‹ï¼‰</li>
<li>Hold and waitï¼šæ¯ä¸ªè¿›ç¨‹å æœ‰è‡³å°‘ä¸€ä¸ªèµ„æºï¼Œå¹¶ç­‰å¾…å¦ä¸€ä¸ªè¢«å æ®çš„èµ„æºã€‚</li>
<li>No preemptionï¼šèµ„æºä¸èƒ½è¢«æŠ¢å ï¼Œåªèƒ½åœ¨è¿›ç¨‹ç»“æŸåä¸»åŠ¨é‡Šæ”¾ã€‚</li>
<li>Circular waitï¼šä¸€ç»„ç­‰å¾…è¿›ç¨‹è·Ÿæƒ³è¦çš„èµ„æºçš„å æœ‰è€…è¿›ç¨‹æˆç¯ï¼Œä¹Ÿå°±æ˜¯è¿›ç¨‹ç¼–å·ä¸éœ€è¦çš„èµ„æºç¼–å·å½¢æˆä¸€ä¸ªå®Œå…¨è½®æ¢ï¼ˆæ²¡æœ‰ä¸€ä¸ªè¿›ç¨‹å¯¹åº”ä¸å…¶ç¼–å·ç›¸åŒçš„èµ„æºï¼Œè€Œç¼–å·ç›¸åŒçš„èµ„æºæŒ‡è¯¥è¿›ç¨‹å½“å‰æ­£æŒæœ‰çš„é‚£ä¸ªèµ„æºï¼‰ï¼ˆæˆ‘æ˜¯è¿™ä¹ˆç†è§£çš„ï¼‰ã€‚åœ¨é˜è¿°è¿™ä¸€ç‚¹æ—¶ï¼Œå¯ä»¥åˆ—å‡ºè¿™ä¸ªè½®æ¢ã€‚</li>
</ul>
<p>å¤„ç†æ­»é”çš„å››ç§æ–¹æ³•</p>
<ul>
<li>ä¿è¯ç³»ç»Ÿä¸ä¼šè¿›å…¥æ­»é”<ul>
<li>æ­»é”é¢„é˜² (deadlock prevention)</li>
<li>æ­»é”é¿å… (deadlock avoidance)</li>
</ul>
</li>
<li>åœ¨ç³»ç»Ÿè¿›å…¥æ­»é”çŠ¶æ€åæ¢å¤<ul>
<li>æ­»é”æ£€æµ‹å’Œæ¢å¤ (deadlock detection and recovery): ä¾‹å¦‚æ•°æ®åº“</li>
</ul>
</li>
<li>å‡è£…ç³»ç»Ÿä¸ä¼šå‘ç”Ÿæ­»é”ï¼ŒçœŸå‘ç”Ÿäº†å°±å¯„ï¼šï¼Ÿ<ul>
<li>å¤§å¤šæ•°æ“ä½œç³»ç»Ÿ(including Linux and Win)é‡‡ç”¨ï¼Œéœ€è¦è½¯ä»¶æ¥å¤„ç†æ­»é”</li>
</ul>
</li>
</ul>
<h3 id="73">7.3 é¢„é˜²ï¼Œé“¶è¡Œå®¶ç®—æ³•</h3>
<p>é¢„é˜²çš„æ ¸å¿ƒæ€è·¯å°±æ˜¯æ‰“ç ´å¿…è¦æ¡ä»¶ä¸­çš„ä»»ä½•ä¸€ä¸ªã€‚åˆ†åˆ«è®¨è®ºå››ä¸ªæ¡ä»¶å¦‚ä½•ç ´å</p>
<ul>
<li>Mutual Exclusion<ul>
<li>é€šè¿‡ä¿è¯ç³»ç»Ÿèµ„æºèƒ½å¤Ÿå…±äº«æ¥æ‰“ç ´</li>
<li>ä½†æ˜¯ä¸ä¸€å®šèƒ½å®ç°ï¼Œå¾ˆå¤šèµ„æºä¸èƒ½å…±äº«e.g. ä¿¡å·é‡</li>
</ul>
</li>
<li>Hold and Wait<ul>
<li>é€šè¿‡ä¿è¯æ¯ä¸ªè¿›ç¨‹ç”³è¯·èµ„æºæ—¶ä¸èƒ½å æœ‰å…¶å®ƒèµ„æº</li>
<li>ç¨‹åºç›´åˆ°å¼€å§‹æ‰§è¡Œå‰æ‰ç”³è¯·æ‰€æœ‰èµ„æº</li>
<li>æˆ–è€…åªå…è®¸è¿›ç¨‹åœ¨æ²¡æœ‰èµ„æºæ—¶æ‰ç”³è¯·èµ„æº</li>
<li>ç¼ºç‚¹æ˜¯èµ„æºåˆ©ç”¨ç‡ä¼šå˜ä½ï¼Œéœ€è¦èµ„æºè¾ƒå¤šçš„è¿›ç¨‹ä¼šå‘ç”Ÿstarvation</li>
</ul>
</li>
<li>No Preemption<ul>
<li>å½“ä¸€ä¸ªè¿›ç¨‹è¯·æ±‚èµ„æºä½†æ²¡æœ‰å¾—åˆ°æ»¡è¶³æ—¶ï¼Œå®ƒå¿…é¡»é‡Šæ”¾å·²ç»æŒæœ‰çš„æ‰€æœ‰èµ„æºï¼Œç›´åˆ°å®ƒéœ€è¦çš„æ‰€æœ‰èµ„æºï¼ˆåŒ…æ‹¬åˆšæ‰é‡Šæ”¾çš„é‚£äº›èµ„æºï¼‰éƒ½å¯ç”¨æ—¶æ‰èƒ½ä¸€å¹¶è·å–å¹¶ç»§ç»­æ‰§è¡Œã€‚</li>
<li>ä¿¡å·é‡ä¸èƒ½è¿™æ ·é‡Šæ”¾</li>
<li>ä¼šé™ä½èµ„æºåˆ©ç”¨ç‡</li>
</ul>
</li>
<li>Circular Wait<ul>
<li>å¯¹æ‰€æœ‰èµ„æºè¿›è¡Œæ’åºï¼Œè¦æ±‚æ¯ä¸ªè¿›ç¨‹æŒ‰ç…§é€’å¢é¡ºåºç”³è¯·èµ„æº</li>
<li>å¦‚æœç¨‹åºå¼€å‘è€…æ²¡æœ‰æŒ‰æ­¤é¡ºåºæ‰§è¡Œï¼Œå°±ä¼šæ­»é”</li>
<li>ä¹Ÿå¯èƒ½å½±å“èµ„æºåˆ©ç”¨ç‡</li>
</ul>
</li>
</ul>
<h3 id="74">7.4 é¿å…</h3>
<p>é¿å…æ­»é”åˆ™æ˜¯é é¢„æµ‹è¿›ç¨‹æœªæ¥éœ€è¦ä½¿ç”¨å“ªäº›èµ„æºã€èµ„æºçš„ä½¿ç”¨é¡ºåºç­‰ã€‚ç³»ç»Ÿéœ€è¦è®¾è®¡ç®—æ³•è®¡ç®—ä¸€ä¸‹æ¥é¿å…ã€‚æ‰€ä»¥æ—¢éœ€è¦é¢å¤–ä¿¡æ¯ï¼Œåˆéœ€è¦é¢å¤–ç®—æ³•ã€‚</p>
<p>é¢å¤–ä¿¡æ¯åŒ…æ‹¬</p>
<p>èµ„æºåˆ†é…çŠ¶æ€resource allocation state:</p>
<ul>
<li>æ¯ä¸ªè¿›ç¨‹å£°æ˜å¯èƒ½å¯¹æ¯ç§èµ„æºç±»å‹çš„æœ€å¤§éœ€æ±‚ï¼ˆmaximum demandsï¼‰</li>
<li>å½“å‰ç³»ç»Ÿçš„availableå’Œallocatedçš„èµ„æºæ•°ç›®</li>
</ul>
<p>èµ„æºåˆ†é…å›¾ç®—æ³•ï¼šé€‚ç”¨äºæ¯ç§èµ„æºéƒ½åªæœ‰ä¸€ä¸ªå®ä¾‹çš„æƒ…å†µ</p>
<p>åœ¨èµ„æºåˆ†é…å›¾ä¸ŠåŠ ä¸€ç§è¾¹ï¼šclaim edgeã€‚è¡¨ç¤ºä¸€ä¸ªè¿›ç¨‹å¯èƒ½ä¼šéœ€è¦æŸç§èµ„æºï¼Œç”¨è™šçº¿è¡¨ç¤ºã€‚è½¬åŒ–å…³ç³»ä¸º</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#__codelineno-17-1"></a>graph TD
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#__codelineno-17-2"></a>    claim_edge --éœ€æ±‚å‡ºç°--&gt; request_edge
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#__codelineno-17-3"></a>    request_edge --ä¸ä¼šå‡ºç°ç¯çš„è¯å°±éœ€æ±‚æ»¡è¶³--&gt; assignment_edge
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#__codelineno-17-4"></a>    assignment_edge --èµ„æºé‡Šæ”¾--&gt; claim_edge
</span></code></pre></div>
<p>å®‰å…¨çŠ¶æ€ Safe State</p>
<p>æ˜¯æŒ‡æŒ‰ç…§ä¸€å®šé¡ºåºä¸ºæ¯ä¸ªè¿›ç¨‹åˆ†é…èµ„æºï¼ŒåŒæ—¶é¿å…æ­»é”ã€‚</p>
<p>å…·ä½“è€Œè¨€ï¼Œå¦‚æœæŸä¸ªèµ„æºæœ‰Aä¸ªç©ºé—²ï¼Œå¯¹äºæ¯ä¸ªæ´»åŠ¨è¿›ç¨‹Piï¼Œå„è‡ªæŒæœ‰Ciä¸ªè¯¥èµ„æºï¼Œå¹¶ä¸”ä»ç„¶éœ€è¦Diä¸ªèµ„æºã€‚</p>
<p>å¦‚æœä¸€ä¸ªåºåˆ—<P1, â€¦ Pn>ä½¿å¾—å¯¹äºä»»æ„Piï¼Œéƒ½æœ‰A+\sum[j&lt;i][j=1]{Ci} â‰¥ Di, åˆ™ç³»ç»Ÿå¤„äºå®‰å…¨çŠ¶æ€ã€‚</p>
<p>å¯ä»¥ç”¨å½’çº³æ³•è¯æ˜ï¼šå¦‚æœPiçš„éœ€æ±‚ä¸èƒ½è¢«ç«‹åˆ»æ»¡è¶³ï¼Œåªéœ€è¦ç­‰å¾…Pj | j&lt;i å…¨éƒ¨å®Œæˆã€‚Piå°±èƒ½è·å¾—æ‰€éœ€èµ„æº
<img alt="" src="../asset/OS215.png" />
å®‰å…¨çŠ¶æ€æ˜¯éæ­»é”çŠ¶æ€çš„å­é›†</p>
<p>é“¶è¡Œå®¶ç®—æ³• Bankerâ€™s Algorithm</p>
<p>é€šè¿‡available, max, allocation, need è¿™å››ä¸ªçŸ©é˜µåˆ»ç”»ä¸€ä¸ªæ—¶é—´å†…å„ä¸ªè¿›ç¨‹å¯¹å„ç§èµ„æºçš„æŒæœ‰å’Œéœ€æ±‚çŠ¶å†µï¼Œä»¥åŠå½“å‰ç³»ç»Ÿçš„èµ„æºæƒ…å†µã€‚OSåº”ä½¿ç”¨è¿™äº›æ•°æ®åˆ¤æ–­ç³»ç»Ÿæ˜¯å¦å®‰å…¨çŠ¶æ€ã€‚</p>
<p>æ‰¾ä¸€ä¸ªå®‰å…¨åºåˆ—çš„åŸºæœ¬æ€è·¯æ˜¯ï¼šé€‰ä¸€ä¸ªneedï¼ˆçš„æ¯ä¸€é¡¹å¯¹åº”åœ°ï¼‰å°äºavailableï¼ˆçš„å¯¹åº”é¡¹ï¼‰çš„è¿›ç¨‹ï¼Œè¿è¡Œå®Œåä¼šå°†allocationé‡Šæ”¾å›available.</p>
<p>å‡è®¾è¿™ä¸ªéœ€æ±‚è¢«æ¥å—äº†ï¼Œæ›´æ–°å¯¹åº”çš„needï¼Œavailableï¼Œallocation</p>
<p>åœ¨æ­¤çŠ¶æ€ä¸‹æ¨æ¼”æ˜¯å¦æœ‰åˆæ³•çš„å®‰å…¨åºåˆ—ã€‚</p>
<p>è€Œå†³å®šä¸€ä¸ªéœ€æ±‚æ˜¯å¦åº”å½“è¢«æ»¡è¶³çš„æ–¹æ¡ˆæ˜¯ï¼Œå‡è®¾è¢«æ¥å—äº†ï¼Œæ ¹æ®è¯¥éœ€æ±‚æ›´æ–°needï¼Œavailableï¼Œallocationï¼Œåœ¨æ­¤çŠ¶æ€æ¨æ¼”æ˜¯å¦æœ‰åˆæ³•çš„å®‰å…¨åºåˆ—ã€‚</p>
<h3 id="75">7.5 æ£€æµ‹</h3>
<p>Single Instance Resources</p>
<p>wait-for graphæ¥è§£å†³</p>
<p>åœ¨è¿™ä¸ªå›¾é‡Œæ‰¾ç¯ï¼Œç”¨æ‹“æ‰‘æ’åºæ—¶é—´å¤æ‚åº¦æ˜¯O(V+E)çš„ï¼Œæœ€å·®æƒ…å†µä¸‹æ˜¯O(n^2)çš„ã€‚
<img alt="" src="../asset/OS216.png" />
Multi-Instance Resources</p>
<p>ç±»ä¼¼é“¶è¡Œå®¶ç®—æ³•ï¼Œå¦‚æœæ‰¾ä¸åˆ°ä»»ä½•å®‰å…¨åºåˆ—ï¼Œè¯´æ˜ç³»ç»Ÿå¤„äºæ­»é”ã€‚</p>
<h3 id="76">7.6 æ¢å¤</h3>
<ul>
<li>
<p>è¿›ç¨‹ç»ˆæ­¢Terminate deadlocked processes</p>
<p>å®ƒå’Œèµ„æºæŠ¢å çš„åŒºåˆ«ä¼¼ä¹æ˜¯ï¼Œè¿›ç¨‹ç»ˆæ­¢ä»£ä»·éå¸¸å¤§ï¼Œå…¶ä¸€æ˜¯éœ€è¦ç»´æŠ¤ç»ˆæ­¢æ—¶çš„çŠ¶æ€ï¼Œå¹¶éœ€è¦é‡æ–°è®¡ç®—ä¸€äº›å†…å®¹ï¼Œå¹¶éœ€è¦é¿å…äº§ç”Ÿé‡å¤çš„å‰¯ä½œç”¨ã€‚</p>
<p>ç›´æ¥æ”¾å¼ƒæ‰€æœ‰è¿›ç¨‹èŠ±è´¹ä¼šå¾ˆå¤§ã€‚</p>
<p>å¯ä»¥é€‰æ‹©æ¯æ¬¡æ”¾å¼ƒä¸€ä¸ªè¿›ç¨‹ï¼Œç›´åˆ°æ‰€æœ‰æ­»é”ç¯è§£é™¤ã€‚</p>
<p>å¦‚ä½•é€‰æ‹©æ”¾å¼ƒå“ªä¸ªè¿›ç¨‹ï¼šä¸€ç³»åˆ—æŒ‡æ ‡</p>
<ul>
<li>è¿›ç¨‹çš„ä¼˜å…ˆçº§</li>
<li>å·²ç»ç®—äº†å¤šä¹…ï¼Œè¿˜è¦ç®—å¤šä¹…</li>
<li>ç”¨äº†å“ªäº›ã€å¤šå°‘èµ„æºï¼Œæ˜¯å¦å®¹æ˜“è¢«æŠ¢å </li>
<li>è¿˜éœ€è¦å¤šå°‘èµ„æº</li>
<li>ç»ˆæ­¢è¿™ä¸€è¿›ç¨‹çš„å‰ææ˜¯è¿˜éœ€ç»ˆæ­¢å¤šå°‘è¿›ç¨‹</li>
<li>è¿›ç¨‹æ˜¯äº¤äº’çš„è¿˜æ˜¯æ‰¹å¤„ç†çš„</li>
<li>èµ„æºæŠ¢å  Resource Preemption</li>
</ul>
<p>ä¸æ–­æŠ¢å èµ„æºç»™å…¶å®ƒè¿›ç¨‹ï¼Œç›´åˆ°æ¶ˆé™¤æ­»é”ç¯ä¸ºæ­¢</p>
<p>éœ€è¦è€ƒè™‘ä¸‰ä¸ªé—®é¢˜</p>
<ul>
<li>é€‰æ‹©ç‰ºç‰²è¿›ç¨‹ select a victimï¼šä¸è¿›ç¨‹ç»ˆæ­¢çš„é€‰æ³•ç›¸ä¼¼</li>
<li>å›æ»šï¼ˆRollbackï¼‰ï¼šå½“ä¸€ä¸ªè¿›ç¨‹çš„è‹¥å¹²èµ„æºè¢«æŠ¢å ï¼Œéœ€è¦å°†è¿™ä¸ªè¿›ç¨‹å›æ»šåˆ°æŸä¸ªå®‰å…¨çŠ¶æ€ï¼Œå³å›æ»šåˆ°ç”³è¯·é‚£äº›è¢«æŠ¢å çš„èµ„æºä¹‹å‰</li>
<li>é¥¥é¥¿ï¼ˆStarvationï¼‰ï¼šå¦‚ä½•ä¿è¯ä¸ä¼šæ°¸è¿œä»ä¸€ä¸ªè¿›ç¨‹ä¸­æŠ¢å èµ„æºï¼Œå¯ä»¥åœ¨ä»£ä»·è¯„ä»·ä¸­åŠ ä¸€ä¸ªæŒ‡æ ‡å›æ»šæ¬¡æ•°ã€‚è¿™ä¸ªæŒ‡æ ‡çš„è®¾è®¡æ€æƒ³ç±»ä¼¼äºpriority aging</li>
</ul>
</li>
</ul>





                
              </article>
            </div>
          
          
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
            å›åˆ°é¡µé¢é¡¶éƒ¨
          </button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["content.code.copy", "navigation.expand", "navigation.top"], "search": "../../../assets/javascripts/workers/search.74e28a9f.min.js", "translations": {"clipboard.copied": "\u5df2\u590d\u5236", "clipboard.copy": "\u590d\u5236", "search.result.more.one": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.more.other": "\u5728\u8be5\u9875\u4e0a\u8fd8\u6709 # \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.none": "\u6ca1\u6709\u627e\u5230\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.one": "\u627e\u5230 1 \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.other": "# \u4e2a\u7b26\u5408\u6761\u4ef6\u7684\u7ed3\u679c", "search.result.placeholder": "\u952e\u5165\u4ee5\u5f00\u59cb\u641c\u7d22", "search.result.term.missing": "\u7f3a\u5c11", "select.version": "\u9009\u62e9\u5f53\u524d\u7248\u672c"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.220ee61c.min.js"></script>
      
        
          <script src="../../../javascripts/mathjax.js"></script>
        
      
        
          <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        
      
        
          <script src="../../../javascripts/tex-mml-chtml.js"></script>
        
      
    
  </body>
</html>